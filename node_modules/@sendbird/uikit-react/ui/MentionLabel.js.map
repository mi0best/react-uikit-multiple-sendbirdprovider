{"version":3,"file":"MentionLabel.js","sources":["../../src/ui/MentionLabel/index.tsx"],"sourcesContent":["import './index.scss';\n\nimport React, {\n  ReactElement,\n  useRef,\n  useState,\n  useCallback,\n} from 'react';\nimport type { User } from '@sendbird/chat';\n\nimport ContextMenu, { MenuItems } from '../ContextMenu';\nimport Label, { LabelTypography, LabelColors } from '../Label';\nimport UserProfile from '../UserProfile';\nimport useSendbirdStateContext from '../../hooks/useSendbirdStateContext';\n\ninterface MentionLabelProps {\n  mentionTemplate: string;\n  mentionedUserId: string;\n  mentionedUserNickname: string;\n  isByMe: boolean;\n}\n\nexport default function MentionLabel(props: MentionLabelProps): JSX.Element {\n  const {\n    mentionTemplate,\n    mentionedUserId,\n    mentionedUserNickname,\n    isByMe,\n  } = props;\n\n  const mentionRef = useRef();\n\n  const sendbirdState = useSendbirdStateContext();\n  const userId = sendbirdState?.config?.userId;\n  const sdk = sendbirdState?.stores?.sdkStore?.sdk;\n  const amIBeingMentioned = userId === mentionedUserId;\n  const [user, setUser] = useState<User| null>();\n  const fetchUser = useCallback(\n    (toggleDropdown) => {\n      if (user || !sdk?.createApplicationUserListQuery) {\n        toggleDropdown();\n        return;\n      }\n      const query = sdk?.createApplicationUserListQuery({\n        userIdsFilter: [mentionedUserId],\n      });\n      query.next().then((members) => {\n        if (members?.length > 0) {\n          setUser(members[0]);\n        }\n        toggleDropdown();\n      });\n    },\n    [sdk, mentionedUserId],\n  );\n  return (\n    <ContextMenu\n      menuTrigger={(toggleDropdown: () => void): ReactElement => (\n        <a\n          className={`\n            sendbird-word__mention\n            ${amIBeingMentioned ? 'sendbird-word__mention--me' : ''}\n          `}\n          onClick={() => fetchUser(toggleDropdown)}\n          ref={mentionRef}\n          data-userid={mentionedUserId}\n          data-nickname={mentionedUserNickname}\n          data-sb-mention={true}\n        >\n          <Label\n            type={LabelTypography.CAPTION_1}\n            color={isByMe ? LabelColors.ONCONTENT_1 : LabelColors.ONBACKGROUND_1}\n          >\n            {`${mentionTemplate}${mentionedUserNickname}`}\n          </Label>\n        </a>\n      )}\n      menuItems={(closeDropdown: () => void): ReactElement => (\n        <MenuItems\n          /**\n          * parentRef: For catching location(x, y) of MenuItems\n          * parentContainRef: For toggling more options(menus & reactions)\n          */\n          parentRef={mentionRef}\n          parentContainRef={mentionRef}\n          closeDropdown={closeDropdown}\n          style={{ paddingTop: '0px', paddingBottom: '0px' }}\n        >\n          <UserProfile\n            user={user}\n            onSuccess={closeDropdown}\n            currentUserId={userId}\n          />\n        </MenuItems>\n      )}\n    />\n  );\n}\n"],"names":["MentionLabel","props","mentionTemplate","mentionedUserId","mentionedUserNickname","isByMe","mentionRef","useRef","sendbirdState","useSendbirdStateContext","userId","_a","config","sdk","_c","_b","stores","sdkStore","amIBeingMentioned","_d","useState","user","setUser","fetchUser","useCallback","toggleDropdown","createApplicationUserListQuery","query","userIdsFilter","next","then","members","length","React","createElement","ContextMenu","menuTrigger","className","concat","onClick","ref","Label","type","LabelTypography","CAPTION_1","color","LabelColors","ONCONTENT_1","ONBACKGROUND_1","menuItems","closeDropdown","MenuItems","parentRef","parentContainRef","style","paddingTop","paddingBottom","UserProfile","onSuccess","currentUserId"],"mappings":"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"}