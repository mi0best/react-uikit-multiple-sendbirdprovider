{"version":3,"file":"MessageInput.js","sources":["../../src/ui/MessageInput/messageInputUtils.ts","../../src/ui/MessageInput/index.jsx"],"sourcesContent":["/**\n * Write new utils here\n * Migrate old utils as needed, and delete utils.js\n */\n// import { ChannelType } from '@sendbird/chat';\nimport type { GroupChannel } from '@sendbird/chat/groupChannel';\nimport type { OpenChannel } from '@sendbird/chat/openChannel';\nimport { match } from 'ts-pattern';\n\nimport type { SendBirdStateConfig } from '../../lib/types';\n\n/**\n * FIXME:\n * Import this ChannelType enum from @sendbird/chat\n * once MessageInput.spec unit tests can be run \\wo jest <-> ESM issue\n */\nenum ChannelType {\n  BASE = 'base',\n  GROUP = 'group',\n  OPEN = 'open',\n}\n/**\n * FIXME: Simplify this in UIKit@v4\n * If customer is using MessageInput inside our modules(ie: Channel, Thread, etc),\n * we should use the config from the module.\n * If customer is using MessageInput outside our modules(ie: custom UI),\n * we expect Channel to be undefined and customer gets control to show/hide file-upload.\n * @param {*} channel GroupChannel | OpenChannel\n * @param {*} config SendBirdStateConfig\n * @returns boolean\n */\nexport const checkIfFileUploadEnabled = ({ channel, config }: {\n  channel?: GroupChannel | OpenChannel,\n  config?: SendBirdStateConfig,\n}) => {\n  const isEnabled = match(channel?.channelType)\n    .with(ChannelType.GROUP, () => config?.groupChannel?.enableDocument)\n    .with(ChannelType.OPEN, () => config?.openChannel?.enableDocument)\n    .otherwise(() => true);\n\n  return isEnabled;\n};\n","import React, {\n  useRef,\n  useMemo,\n  useState,\n  useEffect,\n  useCallback,\n} from 'react';\nimport PropTypes from 'prop-types';\n\nimport './index.scss';\nimport { MessageInputKeys, NodeNames, NodeTypes } from './const';\n\nimport { USER_MENTION_TEMP_CHAR } from '../../modules/Channel/context/const';\nimport IconButton from '../IconButton';\nimport Button, { ButtonTypes, ButtonSizes } from '../Button';\nimport renderMentionLabelToString from '../MentionUserLabel/renderToString';\nimport Icon, { IconTypes, IconColors } from '../Icon';\nimport Label, { LabelTypography, LabelColors } from '../Label';\nimport { useLocalization } from '../../lib/LocalizationContext';\nimport useSendbirdStateContext from '../../hooks/useSendbirdStateContext';\n\nimport {\n  isChannelTypeSupportsMultipleFilesMessage,\n  nodeListToArray,\n  sanitizeString,\n} from './utils';\nimport {\n  arrayEqual,\n  getClassName,\n  getMimeTypesUIKitAccepts,\n} from '../../utils';\nimport usePaste from './hooks/usePaste';\nimport { tokenizeMessage } from '../../modules/Message/utils/tokens/tokenize';\nimport { USER_MENTION_PREFIX } from '../../modules/Message/consts';\nimport { TOKEN_TYPES } from '../../modules/Message/utils/tokens/types';\nimport { checkIfFileUploadEnabled } from './messageInputUtils';\n\nconst TEXT_FIELD_ID = 'sendbird-message-input-text-field';\nconst LINE_HEIGHT = 76;\nconst noop = () => { };\n\nconst displayCaret = (element, position) => {\n  const range = document.createRange();\n  const sel = window.getSelection();\n  range.setStart(element.childNodes[0], position);\n  range.collapse(true);\n  sel.removeAllRanges();\n  sel.addRange(range);\n  element.focus();\n};\n\nconst resetInput = (ref) => {\n  try {\n    /* eslint-disable no-param-reassign */\n    ref.current.innerHTML = '';\n  } catch {\n    //\n  }\n};\n\nconst initialTargetStringInfo = {\n  targetString: '',\n  startNodeIndex: null,\n  startOffsetIndex: null,\n  endNodeIndex: null,\n  endOffsetIndex: null,\n};\n\nconst MessageInput = React.forwardRef((props, ref) => {\n  const {\n    className,\n    messageFieldId,\n    isEdit,\n    isMentionEnabled,\n    isVoiceMessageEnabled,\n    isSelectingMultipleFilesEnabled,\n    disabled,\n    message,\n    placeholder,\n    maxLength,\n    onFileUpload,\n    onSendMessage,\n    onUpdateMessage,\n    onCancelEdit,\n    onStartTyping,\n    channelUrl,\n    channel,\n    mentionSelectedUser,\n    onUserMentioned,\n    onMentionStringChange,\n    onMentionedUserIdsUpdated,\n    onVoiceMessageIconClick,\n    onKeyUp,\n    onKeyDown,\n    renderFileUploadIcon,\n    renderVoiceMessageIcon,\n    renderSendMessageIcon,\n    setMentionedUsers,\n    acceptableMimeTypes,\n  } = props;\n  const textFieldId = messageFieldId || TEXT_FIELD_ID;\n  const { stringSet } = useLocalization();\n  const { config } = useSendbirdStateContext();\n\n  const isFileUploadEnabled = checkIfFileUploadEnabled({\n    channel,\n    config,\n  });\n\n  const fileInputRef = useRef(null);\n  const [isInput, setIsInput] = useState(false);\n  const [mentionedUserIds, setMentionedUserIds] = useState([]);\n  const [targetStringInfo, setTargetStringInfo] = useState({ ...initialTargetStringInfo });\n  const setHeight = useMemo(() => (\n    () => {\n      try {\n        const elem = ref?.current;\n        const MAX_HEIGHT = window.document.body.offsetHeight * 0.6;\n        if (elem && elem.scrollHeight >= LINE_HEIGHT) {\n          if (MAX_HEIGHT < elem.scrollHeight) {\n            elem.style.height = 'auto';\n            elem.style.height = `${MAX_HEIGHT}px`;\n          } else {\n            elem.style.height = 'auto';\n            elem.style.height = `${elem.scrollHeight}px`;\n          }\n        } else {\n          elem.style.height = '';\n        }\n      } catch (error) {\n        // error\n      }\n    }\n  ), []);\n\n  // #Edit mode\n  // for easilly initialize input value from outside, but\n  // useEffect(_, [channelUrl]) erase it\n  const initialValue = props?.value;\n  useEffect(() => {\n    const textField = ref?.current;\n    try {\n      textField.innerHTML = initialValue;\n      displayCaret(textField, initialValue?.length);\n    } catch {\n      //\n    }\n    setMentionedUserIds([]);\n    setIsInput(textField?.textContent?.trim().length > 0);\n    setHeight();\n  }, [initialValue]);\n\n  // #Mention | Clear input value when channel changes\n  useEffect(() => {\n    if (!isEdit) {\n      setIsInput(false);\n      resetInput(ref);\n    }\n  }, [channelUrl]);\n\n  // #Mention & #Edit | Fill message input values\n  useEffect(() => {\n    if (isEdit && message?.messageId) {\n      // const textField = document.getElementById(textFieldId);\n      const textField = ref?.current;\n      if (isMentionEnabled\n        && message?.mentionedUsers?.length > 0\n        && message?.mentionedMessageTemplate?.length > 0\n      ) {\n        /* mention enabled */\n        const { mentionedUsers = [] } = message;\n        const tokens = tokenizeMessage({\n          messageText: message?.mentionedMessageTemplate,\n          mentionedUsers,\n        });\n        textField.innerHTML = tokens.map((token) => {\n          if (token.type === TOKEN_TYPES.mention) {\n            const mentionedUser = mentionedUsers.find((user) => user.userId === token.userId);\n            const nickname = `${USER_MENTION_PREFIX}${mentionedUser?.nickname || token.value || stringSet.MENTION_NAME__NO_NAME}`;\n            return renderMentionLabelToString({\n              userId: token.userId,\n              nickname,\n            });\n          }\n          return sanitizeString(token.value);\n        }).join(' ');\n      } else {\n        /* mention disabled */\n        try {\n          textField.innerHTML = sanitizeString(message?.message);\n        } catch {\n          //\n        }\n        setMentionedUserIds([]);\n      }\n      setIsInput(textField?.textContent?.trim().length > 0);\n      setHeight();\n    }\n  }, [isEdit, message]);\n\n  // #Mention | Detect MentionedLabel modified\n  const useMentionedLabelDetection = useCallback(() => {\n    const textField = ref?.current;\n    if (isMentionEnabled) {\n      const newMentionedUserIds = [...textField.getElementsByClassName('sendbird-mention-user-label')].map((node) => node?.dataset?.userid);\n      if (!arrayEqual(mentionedUserIds, newMentionedUserIds) || newMentionedUserIds.length === 0) {\n        onMentionedUserIdsUpdated(newMentionedUserIds);\n        setMentionedUserIds(newMentionedUserIds);\n      }\n    }\n    setIsInput(textField.textContent?.trim().length > 0);\n  }, [targetStringInfo, isMentionEnabled]);\n\n  // #Mention | Replace selected user nickname to the MentionedUserLabel\n  useEffect(() => {\n    if (isMentionEnabled && mentionSelectedUser) {\n      const {\n        targetString,\n        startNodeIndex,\n        startOffsetIndex,\n        endNodeIndex,\n        endOffsetIndex,\n      } = targetStringInfo;\n      if (targetString && startNodeIndex !== null && startOffsetIndex !== null) {\n        // const textField = document.getElementById(textFieldId);\n        const textField = ref?.current;\n        const childNodes = nodeListToArray(textField?.childNodes);\n        const frontTextNode = document?.createTextNode(\n          childNodes[startNodeIndex]?.textContent.slice(0, startOffsetIndex),\n        );\n        const backTextNode = document?.createTextNode(\n          `\\u00A0${childNodes[endNodeIndex]?.textContent.slice(endOffsetIndex)}`,\n        );\n        const mentionLabel = renderMentionLabelToString({\n          userId: mentionSelectedUser?.userId,\n          nickname: `${USER_MENTION_TEMP_CHAR}${mentionSelectedUser?.nickname || stringSet.MENTION_NAME__NO_NAME}`,\n        });\n        const div = document.createElement('div');\n        div.innerHTML = mentionLabel;\n        const newNodes = [\n          ...childNodes.slice(0, startNodeIndex),\n          frontTextNode,\n          div.childNodes[0],\n          backTextNode,\n          ...childNodes.slice(endNodeIndex + 1),\n        ];\n        textField.innerHTML = '';\n        newNodes.forEach((newNode) => {\n          textField.appendChild(newNode);\n        });\n        onUserMentioned(mentionSelectedUser);\n        if (window.getSelection || document.getSelection) {\n          // set caret postion\n          const selection = window.getSelection() || document.getSelection();\n          selection.removeAllRanges();\n          const range = new Range();\n          range.selectNodeContents(textField);\n          range.setStart(textField.childNodes[startNodeIndex + 2], 1);\n          range.setEnd(textField.childNodes[startNodeIndex + 2], 1);\n          range.collapse(false);\n          selection.addRange(range);\n          textField.focus();\n        }\n        setTargetStringInfo({ ...initialTargetStringInfo });\n        setHeight();\n        useMentionedLabelDetection();\n      }\n    }\n  }, [mentionSelectedUser, isMentionEnabled]);\n\n  // #Mention | Detect mentioning user nickname\n  const useMentionInputDetection = useCallback(() => {\n    const selection = window?.getSelection?.() || document?.getSelection?.();\n    const textField = ref?.current;\n    if (selection.anchorNode === textField) {\n      onMentionStringChange('');\n    }\n    if (isMentionEnabled && selection\n      && selection.anchorNode === selection.focusNode\n      && selection.anchorOffset === selection.focusOffset\n    ) {\n      let textStack = '';\n      let startNodeIndex = null;\n      let startOffsetIndex = null;\n      for (let index = 0; index < textField.childNodes.length; index += 1) {\n        const currentNode = textField.childNodes[index];\n        if (currentNode.nodeType === NodeTypes.TextNode) {\n          /* text node */\n          const textContent = (currentNode === selection.anchorNode)\n            ? currentNode?.textContent.slice(0, selection.anchorOffset) || ''\n            : currentNode?.textContent || '';\n          if (textStack.length > 0) {\n            textStack += textContent;\n          } else {\n            let charLastIndex = textContent.lastIndexOf(USER_MENTION_TEMP_CHAR);\n            for (let i = charLastIndex - 1; i > -1; i -= 1) {\n              if (textContent[i] === USER_MENTION_TEMP_CHAR) {\n                charLastIndex = i;\n              } else {\n                break;\n              }\n            }\n            if (charLastIndex > -1) {\n              textStack = textContent;\n              startNodeIndex = index;\n              startOffsetIndex = charLastIndex;\n            }\n          }\n        } else {\n          /* other nodes */\n          textStack = '';\n          startNodeIndex = null;\n          startOffsetIndex = null;\n        }\n        if (currentNode === selection.anchorNode) {\n          /**\n           * targetString could be ''\n           * startNodeIndex and startOffsetIndex could be null\n           */\n          const targetString = textStack ? textStack.slice(startOffsetIndex) : '';// include template character\n          setTargetStringInfo({\n            targetString,\n            startNodeIndex,\n            startOffsetIndex,\n            endNodeIndex: index,\n            endOffsetIndex: selection.anchorOffset,\n          });\n          onMentionStringChange(targetString);\n          return;\n        }\n      }\n    }\n  }, [isMentionEnabled]);\n\n  const sendMessage = () => {\n    const textField = ref?.current;\n    if (!isEdit && textField?.textContent) {\n      let messageText = '';\n      let mentionTemplate = '';\n      textField.childNodes.forEach((node) => {\n        if (node.nodeType === NodeTypes.ElementNode && node.nodeName === NodeNames.Span) {\n          const { innerText, dataset = {} } = node;\n          const { userid = '' } = dataset;\n          messageText += innerText;\n          mentionTemplate += `${USER_MENTION_TEMP_CHAR}{${userid}}`;\n        } else if (node.nodeType === NodeTypes.ElementNode && node.nodeName === NodeNames.Br) {\n          messageText += '\\n';\n          mentionTemplate += '\\n';\n        } else if (node?.nodeType === NodeTypes.ElementNode && node?.nodeName === NodeNames.Div) {\n          // handles newline in safari\n          const { textContent = '' } = node;\n          messageText += `\\n${textContent}`;\n          mentionTemplate += `\\n${textContent}`;\n        } else { // other nodes including text node\n          const { textContent = '' } = node;\n          messageText += textContent;\n          mentionTemplate += textContent;\n        }\n      });\n      const params = { message: messageText, mentionTemplate };\n      onSendMessage(params);\n      resetInput(ref);\n      // important: keeps the keyboard open -> must add test on refactor\n      textField.focus();\n      setIsInput(false);\n      setHeight();\n    }\n  };\n  const isEditDisabled = !(ref?.current?.textContent?.trim());\n  const editMessage = () => {\n    const textField = ref?.current;\n    const messageId = message?.messageId;\n    if (isEdit && messageId) {\n      let messageText = '';\n      let mentionTemplate = '';\n      textField.childNodes.forEach((node) => {\n        if (node.nodeType === NodeTypes.ElementNode && node.nodeName === NodeNames.Span) {\n          const { innerText, dataset = {} } = node;\n          const { userid = '' } = dataset;\n          messageText += innerText;\n          mentionTemplate += `${USER_MENTION_TEMP_CHAR}{${userid}}`;\n          messageText += '\\n';\n          mentionTemplate += '\\n';\n        } else { // other nodes including text node\n          const { textContent = '' } = node;\n          messageText += textContent;\n          mentionTemplate += textContent;\n        }\n      });\n      const params = { messageId, message: messageText, mentionTemplate };\n      onUpdateMessage(params);\n      resetInput(ref);\n    }\n  };\n  const onPaste = usePaste({\n    ref,\n    setMentionedUserIds,\n    setMentionedUsers,\n    channel,\n    setIsInput,\n    setHeight,\n  });\n\n  return (\n    <form\n      className={getClassName([\n        className,\n        isEdit ? 'sendbird-message-input__edit' : '',\n        disabled ? 'sendbird-message-input-form__disabled' : '',\n      ])}\n    >\n      <div\n        className={getClassName([\n          'sendbird-message-input',\n          disabled ? 'sendbird-message-input__disabled' : '',\n        ])}\n      >\n        <div\n          id={`${textFieldId}${isEdit ? message?.messageId : ''}`}\n          className={`sendbird-message-input--textarea ${textFieldId}`}\n          contentEditable={!disabled}\n          role=\"textbox\"\n          aria-label=\"Text Input\"\n          disabled={disabled}\n          ref={ref}\n          maxLength={maxLength}\n          onKeyDown={(e) => {\n            const preventEvent = onKeyDown(e);\n            if (preventEvent) {\n              e.preventDefault();\n            } else {\n              if (!e.shiftKey && e.key === MessageInputKeys.Enter\n                && ref?.current?.textContent?.trim().length > 0\n                && e?.nativeEvent?.isComposing !== true\n              ) {\n                e.preventDefault();\n                sendMessage();\n              }\n              if (e.key === MessageInputKeys.Backspace\n                && ref?.current?.childNodes?.length === 2\n                && !ref?.current?.childNodes?.[0]?.textContent\n                && ref?.current.childNodes?.[1]?.nodeType === NodeTypes.ElementNode\n              ) {\n                ref?.current.removeChild(ref?.current.childNodes[1]);\n              }\n            }\n          }}\n          onKeyUp={(e) => {\n            const preventEvent = onKeyUp(e);\n            if (preventEvent) {\n              e.preventDefault();\n            } else {\n              useMentionInputDetection();\n            }\n          }}\n          onClick={() => {\n            useMentionInputDetection();\n          }}\n          onInput={() => {\n            setHeight();\n            onStartTyping();\n            setIsInput(ref?.current?.textContent?.trim().length > 0);\n            useMentionedLabelDetection();\n          }}\n          onPaste={onPaste}\n        />\n        {/* placeholder */}\n        {(ref?.current?.textContent?.length ?? 0) === 0 && (\n          <Label\n            className=\"sendbird-message-input--placeholder\"\n            type={LabelTypography.BODY_1}\n            color={disabled ? LabelColors.ONBACKGROUND_4 : LabelColors.ONBACKGROUND_3}\n          >\n            {placeholder || stringSet.MESSAGE_INPUT__PLACE_HOLDER}\n          </Label>\n        )}\n        {/* send icon */}\n        {\n          (!isEdit && isInput) && (\n            <IconButton\n              className=\"sendbird-message-input--send\"\n              height=\"32px\"\n              width=\"32px\"\n              onClick={() => sendMessage()}\n            >\n              {\n                renderSendMessageIcon?.() || (\n                  <Icon\n                    type={IconTypes.SEND}\n                    fillColor={disabled ? IconColors.ON_BACKGROUND_4 : IconColors.PRIMARY}\n                    width=\"20px\"\n                    height=\"20px\"\n                  />\n                )\n              }\n            </IconButton>\n          )\n        }\n        {/* file upload icon */}\n        {\n          (!isEdit && !isInput) && (\n            (renderFileUploadIcon?.()\n              // UIKit Dashboard configuration should have lower priority than\n              // renderFileUploadIcon which is set in code level\n              || (isFileUploadEnabled && (\n              <IconButton\n                className={`sendbird-message-input--attach ${isVoiceMessageEnabled ? 'is-voice-message-enabled' : ''}`}\n                height=\"32px\"\n                width=\"32px\"\n                onClick={() => {\n                  // todo: clear previous input\n                  fileInputRef?.current?.click?.();\n                }}\n              >\n                <Icon\n                  type={IconTypes.ATTACH}\n                  fillColor={disabled ? IconColors.ON_BACKGROUND_4 : IconColors.CONTENT_INVERSE}\n                  width=\"20px\"\n                  height=\"20px\"\n                />\n                <input\n                  className=\"sendbird-message-input--attach-input\"\n                  type=\"file\"\n                  ref={fileInputRef}\n                  // It will affect to <Channel /> and <Thread />\n                  onChange={(event) => {\n                    const { files } = event.currentTarget;\n                    onFileUpload(files && files.length === 1 ? [files[0]] : [...files]);\n                    event.target.value = '';\n                  }}\n                  accept={getMimeTypesUIKitAccepts(acceptableMimeTypes)}\n                  multiple={\n                    isSelectingMultipleFilesEnabled\n                    && isChannelTypeSupportsMultipleFilesMessage(channel)\n                  }\n                />\n              </IconButton>\n              )\n              ))\n          )\n        }\n        {/* voice message input trigger */}\n        {(isVoiceMessageEnabled && !isEdit && !isInput) && (\n          <IconButton\n            className=\"sendbird-message-input--voice-message\"\n            width=\"32px\"\n            height=\"32px\"\n            onClick={onVoiceMessageIconClick}\n          >\n            {\n              renderVoiceMessageIcon?.() || (\n                <Icon\n                  type={IconTypes.AUDIO_ON_LINED}\n                  fillColor={disabled ? IconColors.ON_BACKGROUND_4 : IconColors.CONTENT_INVERSE}\n                  width=\"20px\"\n                  height=\"20px\"\n                />\n              )\n            }\n          </IconButton>\n        )}\n      </div>\n      {/* Edit */}\n      {\n        isEdit && (\n          <div className=\"sendbird-message-input--edit-action\">\n            <Button\n              className=\"sendbird-message-input--edit-action__cancel\"\n              type={ButtonTypes.SECONDARY}\n              size={ButtonSizes.SMALL}\n              onClick={onCancelEdit}\n            >\n              {stringSet.BUTTON__CANCEL}\n            </Button>\n            <Button\n              className=\"sendbird-message-input--edit-action__save\"\n              type={ButtonTypes.PRIMARY}\n              size={ButtonSizes.SMALL}\n              disabled={isEditDisabled}\n              onClick={() => editMessage()}\n            >\n              {stringSet.BUTTON__SAVE}\n            </Button>\n          </div>\n        )\n      }\n    </form>\n  );\n});\n\nMessageInput.propTypes = {\n  className: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.arrayOf(PropTypes.string),\n  ]),\n  isEdit: PropTypes.bool,\n  isMentionEnabled: PropTypes.bool,\n  isVoiceMessageEnabled: PropTypes.bool,\n  isSelectingMultipleFilesEnabled: PropTypes.bool,\n  disabled: PropTypes.bool,\n  value: PropTypes.string,\n  placeholder: PropTypes.string,\n  maxLength: PropTypes.number,\n  onFileUpload: PropTypes.func,\n  onSendMessage: PropTypes.func,\n  onUpdateMessage: PropTypes.func,\n  onStartTyping: PropTypes.func,\n  onCancelEdit: PropTypes.func,\n  channelUrl: PropTypes.string,\n  channel: PropTypes.shape({\n    channelType: PropTypes.string,\n  }).isRequired,\n  messageFieldId: PropTypes.string,\n  acceptableMimeTypes: PropTypes.arrayOf(PropTypes.string),\n  // Mention\n  message: PropTypes.shape({\n    messageId: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    message: PropTypes.string,\n    mentionedMessageTemplate: PropTypes.string,\n    mentionedUsers: PropTypes.arrayOf(PropTypes.shape({})),\n  }),\n  setMentionedUsers: PropTypes.func,\n  mentionSelectedUser: PropTypes.shape({\n    userId: PropTypes.string,\n    nickname: PropTypes.string,\n  }),\n  onUserMentioned: PropTypes.func,\n  onMentionStringChange: PropTypes.func,\n  onMentionedUserIdsUpdated: PropTypes.func,\n  onKeyUp: PropTypes.func,\n  onKeyDown: PropTypes.func,\n  // Voice Message\n  onVoiceMessageIconClick: PropTypes.func,\n  renderVoiceMessageIcon: PropTypes.func,\n  renderSendMessageIcon: PropTypes.func,\n  renderFileUploadIcon: PropTypes.func,\n};\n\nMessageInput.defaultProps = {\n  className: '',\n  messageFieldId: '',\n  channelUrl: '',\n  onSendMessage: noop,\n  onUpdateMessage: noop,\n  value: null,\n  message: null,\n  isEdit: false,\n  isMentionEnabled: false,\n  isVoiceMessageEnabled: true,\n  isSelectingMultipleFilesEnabled: false,\n  onVoiceMessageIconClick: noop,\n  disabled: false,\n  placeholder: '',\n  maxLength: 5000,\n  onFileUpload: noop,\n  onCancelEdit: noop,\n  onStartTyping: noop,\n  mentionSelectedUser: null,\n  onUserMentioned: noop,\n  onMentionStringChange: noop,\n  onMentionedUserIdsUpdated: noop,\n  onKeyUp: noop,\n  onKeyDown: noop,\n  setMentionedUsers: noop,\n  renderVoiceMessageIcon: noop,\n  renderFileUploadIcon: noop,\n  renderSendMessageIcon: noop,\n  acceptableMimeTypes: null,\n};\n\nexport default MessageInput;\n"],"names":["ChannelType","checkIfFileUploadEnabled","_a","channel","config","isEnabled","match","channelType","with","GROUP","groupChannel","enableDocument","OPEN","openChannel","otherwise","TEXT_FIELD_ID","LINE_HEIGHT","noop","displayCaret","element","position","range","document","createRange","sel","window","getSelection","setStart","childNodes","collapse","removeAllRanges","addRange","focus","resetInput","ref","current","innerHTML","_unused","initialTargetStringInfo","targetString","startNodeIndex","startOffsetIndex","endNodeIndex","endOffsetIndex","MessageInput","React","forwardRef","props","_ref$current","_ref$current$textCont","_ref$current6","className","messageFieldId","isEdit","isMentionEnabled","isVoiceMessageEnabled","isSelectingMultipleFilesEnabled","disabled","message","placeholder","maxLength","onFileUpload","onSendMessage","onUpdateMessage","onCancelEdit","onStartTyping","channelUrl","mentionSelectedUser","onUserMentioned","onMentionStringChange","onMentionedUserIdsUpdated","onVoiceMessageIconClick","onKeyUp","onKeyDown","renderFileUploadIcon","renderVoiceMessageIcon","renderSendMessageIcon","setMentionedUsers","acceptableMimeTypes","textFieldId","stringSet","useLocalization","useSendbirdStateContext","isFileUploadEnabled","fileInputRef","useRef","isInput","setIsInput","useState","mentionedUserIds","setMentionedUserIds","targetStringInfo","setTargetStringInfo","_objectSpread","setHeight","useMemo","elem","MAX_HEIGHT","body","offsetHeight","scrollHeight","style","height","error","initialValue","value","useEffect","_textField$textConten","textField","length","_unused2","textContent","trim","messageId","_message$mentionedUse","_message$mentionedMes","_textField$textConten2","mentionedUsers","mentionedMessageTemplate","tokens","tokenizeMessage","messageText","map","token","type","TOKEN_TYPES","mention","mentionedUser","find","user","userId","nickname","USER_MENTION_PREFIX","MENTION_NAME__NO_NAME","renderMentionLabelToString","sanitizeString","join","_unused3","useMentionedLabelDetection","useCallback","_textField$textConten3","newMentionedUserIds","getElementsByClassName","node","_node$dataset","dataset","userid","arrayEqual","_document","_childNodes$startNode","_document2","_childNodes$endNodeIn","nodeListToArray","frontTextNode","createTextNode","slice","backTextNode","mentionLabel","USER_MENTION_TEMP_CHAR","div","createElement","newNodes","forEach","newNode","appendChild","selection","Range","selectNodeContents","setEnd","useMentionInputDetection","_window","_window$getSelection","_document3","_document3$getSelecti","call","anchorNode","focusNode","anchorOffset","focusOffset","textStack","index","currentNode","nodeType","NodeTypes","TextNode","charLastIndex","lastIndexOf","i","sendMessage","mentionTemplate","ElementNode","nodeName","NodeNames","Span","innerText","Br","Div","params","isEditDisabled","editMessage","onPaste","usePaste","getClassName","id","contentEditable","role","e","preventEvent","preventDefault","_ref$current2","_e$nativeEvent","_ref$current3","_ref$current4","_ref$current$childNod","shiftKey","key","MessageInputKeys","Enter","nativeEvent","isComposing","Backspace","removeChild","onClick","onInput","_ref$current5","Label","LabelTypography","BODY_1","color","LabelColors","ONBACKGROUND_4","ONBACKGROUND_3","MESSAGE_INPUT__PLACE_HOLDER","IconButton","width","Icon","IconTypes","SEND","fillColor","IconColors","ON_BACKGROUND_4","PRIMARY","_fileInputRef$current","_fileInputRef$current2","click","ATTACH","CONTENT_INVERSE","onChange","event","files","currentTarget","target","accept","getMimeTypesUIKitAccepts","multiple","isChannelTypeSupportsMultipleFilesMessage","AUDIO_ON_LINED","Button","ButtonTypes","SECONDARY","size","ButtonSizes","SMALL","BUTTON__CANCEL","BUTTON__SAVE","propTypes","PropTypes","oneOfType","string","arrayOf","bool","number","func","shape","isRequired","defaultProps"],"mappings":"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"}