{"version":3,"file":"ChannelListUI.js","sources":["../../../src/modules/ChannelList/components/ChannelListUI/index.tsx"],"sourcesContent":["import './channel-list-ui.scss';\n\nimport React, { useState } from 'react';\nimport type { GroupChannel, Member } from '@sendbird/chat/groupChannel';\nimport type { User } from '@sendbird/chat';\n\nimport ChannelListHeader from '../ChannelListHeader';\nimport AddChannel from '../AddChannel';\nimport ChannelPreview from '../ChannelPreview';\nimport ChannelPreviewAction from '../ChannelPreviewAction';\nimport { useChannelListContext } from '../../context/ChannelListProvider';\nimport * as channelListActions from '../../dux/actionTypes';\n\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport EditUserProfile from '../../../EditUserProfile';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport { isAboutSame } from '../../../../utils/utils';\n\ninterface RenderChannelPreviewProps {\n  channel: GroupChannel;\n  onLeaveChannel(\n    channel: GroupChannel,\n    onLeaveChannelCb?: (c: GroupChannel) => void,\n  ): void;\n}\n\ninterface RenderUserProfileProps {\n  user: Member | User;\n  currentUserId: string;\n  close(): void;\n}\n\nexport interface ChannelListUIProps {\n  renderChannelPreview?: (props: RenderChannelPreviewProps) => React.ReactElement;\n  renderUserProfile?: (props: RenderUserProfileProps) => React.ReactElement;\n  renderHeader?: (props: void) => React.ReactElement;\n  renderPlaceHolderError?: (props: void) => React.ReactElement;\n  renderPlaceHolderLoading?: (props: void) => React.ReactElement;\n  renderPlaceHolderEmptyList?: (props: void) => React.ReactElement;\n}\n\nconst ChannelListUI: React.FC<ChannelListUIProps> = (props: ChannelListUIProps) => {\n  const {\n    renderHeader,\n    renderChannelPreview,\n    renderPlaceHolderError,\n    renderPlaceHolderLoading,\n    renderPlaceHolderEmptyList,\n  } = props;\n\n  const [showProfileEdit, setShowProfileEdit] = useState(false);\n\n  const {\n    onThemeChange,\n    allowProfileEdit,\n    allChannels,\n    loading,\n    currentChannel,\n    channelListDispatcher,\n    typingChannels,\n    initialized,\n    fetchChannelList,\n  } = useChannelListContext();\n\n  const state = useSendbirdStateContext();\n  const sdkStore = state?.stores?.sdkStore;\n  const config = state?.config;\n  const {\n    logger,\n    isOnline = false,\n  } = config;\n  const sdkError = sdkStore?.error;\n\n  return (\n    <>\n      <div className=\"sendbird-channel-list__header\">\n        {\n          renderHeader?.() || (\n            <ChannelListHeader\n              onEdit={() => {\n                if (allowProfileEdit) {\n                  setShowProfileEdit(true);\n                }\n              }}\n              allowProfileEdit={allowProfileEdit}\n              renderIconButton={() => (\n                <AddChannel />\n              )}\n            />\n          )\n        }\n      </div>\n      {\n        showProfileEdit && (\n          <EditUserProfile\n            onThemeChange={onThemeChange}\n            onCancel={() => { setShowProfileEdit(false); }}\n            onEditProfile={() => {\n              setShowProfileEdit(false);\n            }}\n          />\n        )\n      }\n      <div\n        className=\"sendbird-channel-list__body\"\n        onScroll={(e) => {\n          const target = e?.target as HTMLDivElement;\n          if (isAboutSame(target.clientHeight + target.scrollTop, target.scrollHeight, 10)) {\n            fetchChannelList();\n          }\n        }}\n      >\n        {\n          (sdkError && !loading) && (\n            (renderPlaceHolderError && typeof renderPlaceHolderError === 'function') ? (\n              renderPlaceHolderError?.()\n            ) : (\n              <PlaceHolder type={PlaceHolderTypes.WRONG} />\n            )\n          )\n        }\n        {/*\n          To do: Implement windowing\n          Implement windowing if you are dealing with large number of messages/channels\n          https://github.com/bvaughn/react-window -> recommendation\n          We hesitate to bring one more dependency to our library,\n          we are planning to implement it inside the library\n        */}\n        <div>\n          {\n            allChannels && allChannels.map((channel, idx) => {\n              // todo: Refactor and move this inside channel - preview\n              const onLeaveChannel = (c, cb) => {\n                logger.info('ChannelList: Leaving channel', c);\n                c.leave()\n                  .then((res) => {\n                    logger.info('ChannelList: Leaving channel success', res);\n                    if (cb && typeof cb === 'function') {\n                      cb(res, null);\n                    }\n                    channelListDispatcher({\n                      type: channelListActions.LEAVE_CHANNEL_SUCCESS,\n                      payload: channel?.url,\n                    });\n                  })\n                  .catch((err) => {\n                    logger.error('ChannelList: Leaving channel failed', err);\n                    if (cb && typeof cb === 'function') {\n                      cb(null, err);\n                    }\n                  });\n              };\n\n              const onClick = () => {\n                if (!isOnline) { return; }\n                logger.info('ChannelList: Clicked on channel:', channel);\n                channelListDispatcher({\n                  type: channelListActions.SET_CURRENT_CHANNEL,\n                  payload: channel,\n                });\n              };\n\n              return (\n                (renderChannelPreview)\n                  ? (\n                    // eslint-disable-next-line\n                    <div key={channel?.url} onClick={onClick}>\n                      {renderChannelPreview({ channel, onLeaveChannel })}\n                    </div>\n                  )\n                  : (\n                    <ChannelPreview\n                      key={channel?.url}\n                      tabIndex={idx}\n                      onClick={onClick}\n                      channel={channel}\n                      onLeaveChannel={() => onLeaveChannel(channel, null)}\n                      isActive={channel?.url === currentChannel?.url}\n                      isTyping={typingChannels?.some(({ url }) => url === channel?.url)}\n                      renderChannelAction={(() => (\n                        <ChannelPreviewAction\n                          channel={channel}\n                          disabled={!isOnline}\n                          onLeaveChannel={() => onLeaveChannel(channel, null)}\n                        />\n                      ))}\n                    />\n                  )\n              );\n            })\n          }\n        </div>\n        {\n          (!initialized && loading) && (\n            (renderPlaceHolderLoading && typeof renderPlaceHolderLoading === 'function') ? (\n              renderPlaceHolderLoading?.()\n            ) : (\n              <PlaceHolder type={PlaceHolderTypes.LOADING} />\n            )\n          )\n        }\n        {\n          (initialized && allChannels?.length === 0) && (\n            (renderPlaceHolderEmptyList && typeof renderPlaceHolderEmptyList === 'function') ? (\n              renderPlaceHolderEmptyList?.()\n            ) : (\n              <PlaceHolder type={PlaceHolderTypes.NO_CHANNELS} />\n            )\n          )\n        }\n      </div>\n    </>\n  );\n};\n\nexport default ChannelListUI;\n"],"names":["ChannelListUI","props","renderHeader","renderChannelPreview","renderPlaceHolderError","renderPlaceHolderLoading","renderPlaceHolderEmptyList","_b","useState","showProfileEdit","setShowProfileEdit","_c","useChannelListContext","onThemeChange","allowProfileEdit","allChannels","loading","currentChannel","channelListDispatcher","typingChannels","initialized","fetchChannelList","state","useSendbirdStateContext","sdkStore","_a","stores","config","logger","_d","isOnline","sdkError","error","React","createElement","Fragment","className","ChannelListHeader","onEdit","renderIconButton","AddChannel","EditUserProfile","onCancel","onEditProfile","onScroll","e","target","isAboutSame","clientHeight","scrollTop","scrollHeight","PlaceHolder","type","PlaceHolderTypes","WRONG","map","channel","idx","onLeaveChannel","c","cb","info","leave","then","res","channelListActions","payload","url","catch","err","onClick","key","ChannelPreview","tabIndex","isActive","isTyping","some","renderChannelAction","ChannelPreviewAction","disabled","LOADING","length","NO_CHANNELS"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA,IAAMA,aAAa,GAAiC,UAACC,KAAyB,EAAA;;AAE1E,EAAA,IAAAC,YAAY,GAKVD,KAAK,CALKC,YAAA;IACZC,oBAAoB,GAIlBF,KAAK,CAJaE,oBAAA;IACpBC,sBAAsB,GAGpBH,KAAK,CAHeG,sBAAA;IACtBC,wBAAwB,GAEtBJ,KAAK,CAAAI,wBAFiB;IACxBC,0BAA0B,GACxBL,KAAK,CAAAK,0BADmB,CAAA;AAGtB,EAAA,IAAAC,EAAA,GAAwCC,QAAQ,CAAC,KAAK,CAAC;AAAtDC,IAAAA,eAAe,GAAAF,EAAA,CAAA,CAAA,CAAA;AAAEG,IAAAA,kBAAkB,GAAAH,EAAA,CAAA,CAAA,CAAmB,CAAA;AAEvD,EAAA,IAAAI,EAUF,GAAAC,qBAAqB,EAAE;IATzBC,aAAa,GAAAF,EAAA,CAAAE,aAAA;IACbC,gBAAgB,GAAAH,EAAA,CAAAG,gBAAA;IAChBC,WAAW,GAAAJ,EAAA,CAAAI,WAAA;IACXC,OAAO,GAAAL,EAAA,CAAAK,OAAA;IACPC,cAAc,GAAAN,EAAA,CAAAM,cAAA;IACdC,qBAAqB,GAAAP,EAAA,CAAAO,qBAAA;IACrBC,cAAc,GAAAR,EAAA,CAAAQ,cAAA;IACdC,WAAW,GAAAT,EAAA,CAAAS,WAAA;IACXC,gBAAgB,sBACS,CAAA;AAE3B,EAAA,IAAMC,KAAK,GAAGC,uBAAuB,EAAE,CAAA;AACvC,EAAA,IAAMC,QAAQ,GAAG,CAAAC,EAAA,GAAAH,KAAK,KAAL,IAAA,IAAAA,KAAK,KAAL,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,KAAK,CAAEI,MAAM,MAAE,IAAA,IAAAD,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,EAAA,CAAAD,QAAQ,CAAA;AACxC,EAAA,IAAMG,MAAM,GAAGL,KAAK,KAAA,IAAA,IAALA,KAAK,KAAL,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,KAAK,CAAEK,MAAM,CAAA;AAE1B,EAAA,IAAAC,MAAM,GAEJD,MAAM,CAAAC,MAFF;IACNC,EAAA,GACEF,MAAM,CAAAG,QADQ;IAAhBA,QAAQ,GAAGD,EAAA,KAAA,KAAA,CAAA,GAAA,KAAK,KAAA,CAAA;AAElB,EAAA,IAAME,QAAQ,GAAGP,QAAQ,KAAA,IAAA,IAARA,QAAQ,KAAR,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,QAAQ,CAAEQ,KAAK,CAAA;EAEhC,oBACEC,cAAA,CAAAC,aAAA,CAAAD,cAAA,CAAAE,QAAA,EAAA,IAAA,eACEF,cAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAKE,IAAAA,SAAS,EAAC,+BAAA;GAEX,EAAA,CAAAlC,YAAY,KAAZ,IAAA,IAAAA,YAAY,uBAAZA,YAAY,EAAI,kBACd+B,cAAA,CAAAC,aAAA,CAACG,iBAAiB,EAAA;IAChBC,MAAM,EAAE,YAAA;AACN,MAAA,IAAIxB,gBAAgB,EAAE;QACpBJ,kBAAkB,CAAC,IAAI,CAAC,CAAA;AACzB,OAAA;KACD;AACFI,IAAAA,gBAAgB,EAAEA,gBAAiB;IACnCyB,gBAAgB,EAAE,YAAA;AAAM,MAAA,oBACtBN,cAAA,CAAAC,aAAA,CAACM,UAAU,MAAA,CAAG,CAAA;AADQ,KAAA;GAGxB,CAGH,CACL,EACE/B,eAAe,iBACbwB,cAAA,CAAAC,aAAA,CAACO,WAAe,EAAA;AACd5B,IAAAA,aAAa,EAAEA,aAAc;IAC7B6B,QAAQ,EAAE,YAAQ;MAAAhC,kBAAkB,CAAC,KAAK,CAAC,CAAA;KAAI;IAC/CiC,aAAa,EAAE,YAAA;MACbjC,kBAAkB,CAAC,KAAK,CAAC,CAAA;AAC3B,KAAA;AAAE,GACF,CACH,eAEHuB,cAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AACEE,IAAAA,SAAS,EAAC,6BAA6B;AACvCQ,IAAAA,QAAQ,EAAE,UAACC,CAAC,EAAA;AACV,MAAA,IAAMC,MAAM,GAAGD,CAAC,KAAA,IAAA,IAADA,CAAC,KAAD,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,CAAC,CAAEC,MAAwB,CAAA;AAC1C,MAAA,IAAIC,WAAW,CAACD,MAAM,CAACE,YAAY,GAAGF,MAAM,CAACG,SAAS,EAAEH,MAAM,CAACI,YAAY,EAAE,EAAE,CAAC,EAAE;AAChF7B,QAAAA,gBAAgB,EAAE,CAAA;AACnB,OAAA;AACH,KAAA;AAAE,GAAA,EAGCU,QAAQ,IAAI,CAACf,OAAO,KAClBZ,sBAAsB,IAAI,OAAOA,sBAAsB,KAAK,UAAU,GACrEA,sBAAsB,KAAA,IAAA,IAAtBA,sBAAsB,KAAtB,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,sBAAsB,EAAI,gBAE1B6B,cAAA,CAAAC,aAAA,CAACiB,WAAW,EAAA;IAACC,IAAI,EAAEC,gBAAgB,CAACC,KAAAA;AAAM,GAAG,CAC9C,CACF,eASHrB,cAAA,CAAAC,aAAA,CAEInB,KAAAA,EAAAA,IAAAA,EAAAA,WAAW,IAAIA,WAAW,CAACwC,GAAG,CAAC,UAACC,OAAO,EAAEC,GAAG,EAAA;AAC1C;AACA,IAAA,IAAMC,cAAc,GAAG,UAACC,CAAC,EAAEC,EAAE,EAAA;AAC3BhC,MAAAA,MAAM,CAACiC,IAAI,CAAC,8BAA8B,EAAEF,CAAC,CAAC,CAAA;MAC9CA,CAAC,CAACG,KAAK,EAAE,CACNC,IAAI,CAAC,UAACC,GAAG,EAAA;AACRpC,QAAAA,MAAM,CAACiC,IAAI,CAAC,sCAAsC,EAAEG,GAAG,CAAC,CAAA;AACxD,QAAA,IAAIJ,EAAE,IAAI,OAAOA,EAAE,KAAK,UAAU,EAAE;AAClCA,UAAAA,EAAE,CAACI,GAAG,EAAE,IAAI,CAAC,CAAA;AACd,SAAA;AACD9C,QAAAA,qBAAqB,CAAC;UACpBkC,IAAI,EAAEa,qBAAwC;AAC9CC,UAAAA,OAAO,EAAEV,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,OAAO,CAAEW,GAAAA;AACnB,SAAA,CAAC,CAAA;AACJ,OAAC,CAAC,CACDC,KAAK,CAAC,UAACC,GAAG,EAAA;AACTzC,QAAAA,MAAM,CAACI,KAAK,CAAC,qCAAqC,EAAEqC,GAAG,CAAC,CAAA;AACxD,QAAA,IAAIT,EAAE,IAAI,OAAOA,EAAE,KAAK,UAAU,EAAE;AAClCA,UAAAA,EAAE,CAAC,IAAI,EAAES,GAAG,CAAC,CAAA;AACd,SAAA;AACH,OAAC,CAAC,CAAA;KACL,CAAA;AAED,IAAA,IAAMC,OAAO,GAAG,YAAA;MACd,IAAI,CAACxC,QAAQ,EAAE;AAAE,QAAA,OAAA;AAAS,OAAA;AAC1BF,MAAAA,MAAM,CAACiC,IAAI,CAAC,kCAAkC,EAAEL,OAAO,CAAC,CAAA;AACxDtC,MAAAA,qBAAqB,CAAC;QACpBkC,IAAI,EAAEa,mBAAsC;AAC5CC,QAAAA,OAAO,EAAEV,OAAAA;AACV,OAAA,CAAC,CAAA;KACH,CAAA;AAED,IAAA,OACGrD,oBAAoB;AAAA;AAEjB;AACA8B,IAAAA,cAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAKqC,MAAAA,GAAG,EAAEf,OAAO,aAAPA,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAPA,OAAO,CAAEW,GAAI;AAACG,MAAAA,OAAO,EAAEA,OAAAA;AAAQ,KAAA,EACtCnE,oBAAoB,CAAC;AAAEqD,MAAAA,OAAO,EAAAA,OAAA;AAAEE,MAAAA,cAAc,EAAAA,cAAAA;AAAE,KAAA,CAC9C,CAAC,gBAGNzB,cAAA,CAAAC,aAAA,CAACsC,cAAc,EAAA;AACbD,MAAAA,GAAG,EAAEf,OAAO,KAAP,IAAA,IAAAA,OAAO,uBAAPA,OAAO,CAAEW,GAAI;AAClBM,MAAAA,QAAQ,EAAEhB,GAAI;AACda,MAAAA,OAAO,EAAEA,OAAQ;AACjBd,MAAAA,OAAO,EAAEA,OAAQ;MACjBE,cAAc,EAAE,YAAA;AAAM,QAAA,OAAAA,cAAc,CAACF,OAAO,EAAE,IAAI,CAAC,CAAA;OAAC;AACpDkB,MAAAA,QAAQ,EAAE,CAAAlB,OAAO,aAAPA,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAPA,OAAO,CAAEW,GAAG,OAAKlD,cAAc,KAAA,IAAA,IAAdA,cAAc,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAdA,cAAc,CAAEkD,GAAG,CAAC;AAC/CQ,MAAAA,QAAQ,EAAExD,cAAc,KAAA,IAAA,IAAdA,cAAc,KAAd,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,cAAc,CAAEyD,IAAI,CAAC,UAACnD,EAAO,EAAA;AAAL,QAAA,IAAA0C,GAAG,GAAA1C,EAAA,CAAA0C,GAAA,CAAA;AAAO,QAAA,OAAAA,GAAG,MAAKX,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,OAAO,CAAEW,GAAG,CAAA,CAAA;AAApB,OAAoB,CAAE;MAClEU,mBAAmB,EAAG,YAAM;AAAA,QAAA,oBAC1B5C,cAAA,CAAAC,aAAA,CAAC4C,oBAAoB,EAAA;AACnBtB,UAAAA,OAAO,EAAEA,OAAQ;UACjBuB,QAAQ,EAAE,CAACjD,QAAS;UACpB4B,cAAc,EAAE,YAAA;AAAM,YAAA,OAAAA,cAAc,CAACF,OAAO,EAAE,IAAI,CAAC,CAAA;AAA7B,WAAA;AAA8B,SACpD,CAAA,CAAA;AALwB,OAAA;AAMzB,KAAA,CAEN,CAAA;AAEP,GAAC,CAEA,CACL,EACG,CAACpC,WAAW,IAAIJ,OAAO,KACrBX,wBAAwB,IAAI,OAAOA,wBAAwB,KAAK,UAAU,GACzEA,wBAAwB,KAAA,IAAA,IAAxBA,wBAAwB,KAAxB,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,wBAAwB,EAAI,gBAE5B4B,cAAA,CAAAC,aAAA,CAACiB,WAAW,EAAA;IAACC,IAAI,EAAEC,gBAAgB,CAAC2B,OAAAA;GAAW,CAChD,CACF,EAGA5D,WAAW,IAAI,CAAAL,WAAW,aAAXA,WAAW,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAXA,WAAW,CAAEkE,MAAM,MAAK,CAAC,KACtC3E,0BAA0B,IAAI,OAAOA,0BAA0B,KAAK,UAAU,GAC7EA,0BAA0B,KAA1B,IAAA,IAAAA,0BAA0B,KAA1B,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,0BAA0B,EAAI,gBAE9B2B,cAAA,CAAAC,aAAA,CAACiB,WAAW,EAAA;IAACC,IAAI,EAAEC,gBAAgB,CAAC6B,WAAAA;GAAY,CACjD,CAGF,CACP,CAAG,CAAA;AAEP;;;;"}