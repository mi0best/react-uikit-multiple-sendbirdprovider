{"version":3,"file":"context.js","sources":["../../src/modules/ChannelSettings/context/ChannelSettingsProvider.tsx"],"sourcesContent":["import React, {\n  useEffect,\n  useState,\n} from 'react';\nimport {\n  GroupChannel,\n  GroupChannelUpdateParams,\n  SendbirdGroupChat,\n} from '@sendbird/chat/groupChannel';\n\nimport useSendbirdStateContext from '../../../hooks/useSendbirdStateContext';\nimport { RenderUserProfileProps } from '../../../types';\nimport { UserProfileProvider } from '../../../lib/UserProfileContext';\nimport uuidv4 from '../../../utils/uuid';\n\ninterface ApplicationUserListQuery {\n  limit?: number;\n  userIdsFilter?: Array<string>;\n  metaDataKeyFilter?: string;\n  metaDataValuesFilter?: Array<string>;\n}\n\ninterface ChannelSettingsQueries {\n  applicationUserListQuery?: ApplicationUserListQuery;\n}\n\ntype OverrideInviteUserType = {\n  users: Array<string>;\n  onClose: () => void;\n  channel: GroupChannel;\n};\n\nexport type ChannelSettingsContextProps = {\n  children?: React.ReactElement;\n  channelUrl: string;\n  className?: string;\n  onCloseClick?(): void;\n  onLeaveChannel?(): void;\n  overrideInviteUser?(params: OverrideInviteUserType): void;\n  onChannelModified?(channel: GroupChannel): void;\n  onBeforeUpdateChannel?(currentTitle: string, currentImg: File, data: string): GroupChannelUpdateParams;\n  queries?: ChannelSettingsQueries;\n  renderUserProfile?: (props: RenderUserProfileProps) => React.ReactElement;\n  disableUserProfile?: boolean;\n};\n\ninterface ChannelSettingsProviderInterface {\n  channelUrl: string;\n  onCloseClick?(): void;\n  onLeaveChannel?(): void;\n  overrideInviteUser?(params: OverrideInviteUserType): void;\n  onChannelModified?(channel: GroupChannel): void;\n  onBeforeUpdateChannel?(currentTitle: string, currentImg: File, data: string): GroupChannelUpdateParams;\n  queries?: ChannelSettingsQueries;\n  setChannelUpdateId(uniqId: string): void;\n  forceUpdateUI(): void;\n  channel: GroupChannel;\n  invalidChannel: boolean;\n}\n\nconst ChannelSettingsContext = React.createContext<ChannelSettingsProviderInterface|null>(undefined);\n\nconst ChannelSettingsProvider: React.FC<ChannelSettingsContextProps> = (props: ChannelSettingsContextProps) => {\n  const {\n    children,\n    className,\n    channelUrl,\n    onCloseClick,\n    onLeaveChannel,\n    onChannelModified,\n    overrideInviteUser,\n    onBeforeUpdateChannel,\n    queries,\n  } = props;\n\n  // fetch store from <SendbirdProvider />\n  const globalStore = useSendbirdStateContext();\n  const { config, stores } = globalStore;\n  const { sdkStore } = stores;\n  const { logger, onUserProfileMessage } = config;\n\n  const { initialized } = sdkStore;\n  const sdk = sdkStore?.sdk as SendbirdGroupChat;\n\n  // hack to keep track of channel updates by triggering useEffect\n  const [channelUpdateId, setChannelUpdateId] = useState(uuidv4());\n  const [channel, setChannel] = useState(null);\n  const [invalidChannel, setInvalidChannel] = useState(false);\n\n  const forceUpdateUI = () => {\n    setChannelUpdateId(uuidv4());\n  };\n\n  useEffect(() => {\n    logger.info('ChannelSettings: Setting up');\n    if (!channelUrl || !initialized || !sdk) {\n      logger.warning('ChannelSettings: Setting up failed', 'No channelUrl or sdk uninitialized');\n      setInvalidChannel(false);\n    } else {\n      if (!sdk || !sdk.groupChannel) {\n        logger.warning('ChannelSettings: No GroupChannel');\n        return;\n      }\n      sdk.groupChannel.getChannel(channelUrl).then((groupChannel) => {\n        if (!groupChannel) {\n          logger.warning('ChannelSettings: Channel not found');\n          setInvalidChannel(true);\n        } else {\n          logger.info('ChannelSettings: Fetched group channel', groupChannel);\n          setInvalidChannel(false);\n          setChannel(groupChannel);\n        }\n      });\n    }\n  }, [channelUrl, initialized, channelUpdateId]);\n\n  return (\n    <ChannelSettingsContext.Provider value={{\n      channelUrl,\n      onCloseClick,\n      onLeaveChannel,\n      onChannelModified,\n      onBeforeUpdateChannel,\n      queries,\n      overrideInviteUser,\n      setChannelUpdateId,\n      forceUpdateUI,\n      channel,\n      invalidChannel,\n    }}>\n      <UserProfileProvider\n        renderUserProfile={props?.renderUserProfile}\n        disableUserProfile={props?.disableUserProfile ?? config?.disableUserProfile}\n        onUserProfileMessage={onUserProfileMessage}\n      >\n        <div className={`sendbird-channel-settings ${className}`}>\n          {children}\n        </div>\n      </UserProfileProvider>\n    </ChannelSettingsContext.Provider>\n  );\n};\n\nexport type UseChannelSettingsType = () => ChannelSettingsProviderInterface;\nconst useChannelSettingsContext: UseChannelSettingsType = () => React.useContext(ChannelSettingsContext);\n\nexport {\n  ChannelSettingsProvider,\n  useChannelSettingsContext,\n};\n"],"names":["ChannelSettingsContext","React","createContext","undefined","ChannelSettingsProvider","props","children","className","channelUrl","onCloseClick","onLeaveChannel","onChannelModified","overrideInviteUser","onBeforeUpdateChannel","queries","globalStore","useSendbirdStateContext","config","stores","sdkStore","logger","onUserProfileMessage","initialized","sdk","_b","useState","uuidv4","channelUpdateId","setChannelUpdateId","_c","channel","setChannel","_d","invalidChannel","setInvalidChannel","forceUpdateUI","useEffect","info","warning","groupChannel","getChannel","then","createElement","Provider","value","UserProfileProvider","renderUserProfile","disableUserProfile","concat","useChannelSettingsContext","useContext"],"mappings":"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"}