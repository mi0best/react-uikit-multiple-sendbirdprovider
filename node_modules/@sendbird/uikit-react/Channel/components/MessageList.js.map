{"version":3,"file":"MessageList.js","sources":["../../../src/modules/Channel/components/MessageList/hooks/useSetScrollToBottom.ts","../../../src/modules/Channel/components/MessageList/hooks/useScrollBehavior.ts","../../../src/modules/Channel/components/MessageList/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDebounce } from '../../../../../hooks/useDebounce';\n\nconst DELAY = 500;\n\nexport function useSetScrollToBottom({\n  loading,\n}: {\n  loading: boolean;\n}): ({\n  scrollBottom: number;\n  scrollToBottomHandler: (e: React.UIEvent<HTMLDivElement, UIEvent>) => void;\n}) {\n  const [scrollBottom, setScrollBottom] = useState(0);\n  useEffect(() => {\n    if (loading) {\n      setScrollBottom(0);\n    }\n  }, [loading]);\n  const scrollCb = (e: React.UIEvent<HTMLDivElement, UIEvent>) => {\n    const element = e.target as HTMLDivElement;\n    try {\n      setScrollBottom(element.scrollHeight - element.scrollTop - element.offsetHeight);\n    } catch {\n      //\n    }\n  };\n  return {\n    scrollBottom,\n    scrollToBottomHandler: useDebounce(scrollCb, DELAY),\n  };\n}\n","import { useEffect } from 'react';\nimport { useChannelContext } from '../../../context/ChannelProvider';\n\nexport function useScrollBehavior() {\n  const {\n    scrollRef,\n    scrollBehavior = 'auto',\n  } = useChannelContext();\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.style.scrollBehavior = scrollBehavior;\n    }\n  }, [scrollRef.current]);\n\n  return null;\n}\n","import './message-list.scss';\n\nimport React from 'react';\n\nimport { useChannelContext } from '../../context/ChannelProvider';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\nimport Message from '../Message';\nimport { EveryMessage, RenderCustomSeparatorProps, RenderMessageProps } from '../../../../types';\nimport { isAboutSame } from '../../context/utils';\nimport { getMessagePartsInfo } from './getMessagePartsInfo';\nimport UnreadCount from '../UnreadCount';\nimport FrozenNotification from '../FrozenNotification';\nimport { SCROLL_BUFFER } from '../../../../utils/consts';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { UserMessage } from '@sendbird/chat/message';\nimport { MessageProvider } from '../../../Message/context/MessageProvider';\nimport { useHandleOnScrollCallback } from '../../../../hooks/useHandleOnScrollCallback';\nimport { useSetScrollToBottom } from './hooks/useSetScrollToBottom';\nimport { useScrollBehavior } from './hooks/useScrollBehavior';\nimport * as utils from '../../context/utils';\n\nconst SCROLL_BOTTOM_PADDING = 50;\n\nexport interface MessageListProps {\n  className?: string;\n  renderMessage?: (props: RenderMessageProps) => React.ReactElement;\n  renderPlaceholderEmpty?: () => React.ReactElement;\n  renderCustomSeparator?: (props: RenderCustomSeparatorProps) => React.ReactElement;\n  renderPlaceholderLoader?: () => React.ReactElement;\n}\n\nconst MessageList: React.FC<MessageListProps> = ({\n  className = '',\n  renderMessage,\n  renderPlaceholderEmpty,\n  renderCustomSeparator,\n  renderPlaceholderLoader,\n}) => {\n  const {\n    allMessages,\n    localMessages,\n    hasMorePrev,\n    hasMoreNext,\n    setInitialTimeStamp,\n    setAnimatedMessageId,\n    setHighLightedMessageId,\n    isMessageGroupingEnabled,\n    scrollRef,\n    onScrollCallback,\n    onScrollDownCallback,\n    messagesDispatcher,\n    messageActionTypes,\n    currentGroupChannel,\n    disableMarkAsRead,\n    filterMessageList,\n    replyType,\n    loading,\n    isScrolled,\n    unreadSince,\n  } = useChannelContext();\n\n  const store = useSendbirdStateContext();\n  const allMessagesFiltered = (typeof filterMessageList === 'function')\n    ? allMessages.filter((filterMessageList as (message: EveryMessage) => boolean))\n    : allMessages;\n  const markAsReadScheduler = store.config.markAsReadScheduler;\n\n  useScrollBehavior();\n\n  const onScroll = () => {\n    const element = scrollRef?.current;\n    if (element == null) {\n      return;\n    }\n\n    const {\n      scrollTop,\n      clientHeight,\n      scrollHeight,\n    } = element;\n\n    if (isAboutSame(scrollTop, 0, SCROLL_BUFFER)) {\n      onScrollCallback();\n    }\n\n    if (isAboutSame(clientHeight + scrollTop, scrollHeight, SCROLL_BUFFER) && hasMoreNext) {\n      onScrollDownCallback(([messages]) => {\n        if (messages) {\n          try {\n            setTimeout(() => utils.scrollIntoLast(0, scrollRef),\n              /**\n               * Rendering MFM takes long time so we need this.\n               * But later we should find better solution.\n               */\n              1000,\n            );\n            // element.scrollTop = scrollHeight - clientHeight;\n            // scrollRef.current.scrollTop = scrollHeight - clientHeight;\n          } catch (error) {\n            //\n          }\n        }\n      });\n    }\n\n    if (!disableMarkAsRead\n      && isAboutSame(clientHeight + scrollTop, scrollHeight, SCROLL_BUFFER)\n      && !!currentGroupChannel\n    ) {\n      messagesDispatcher({\n        type: messageActionTypes.MARK_AS_READ,\n        payload: { channel: currentGroupChannel },\n      });\n      markAsReadScheduler.push(currentGroupChannel);\n    }\n  };\n\n  const onClickScrollBot = () => {\n    setInitialTimeStamp?.(null);\n    setAnimatedMessageId?.(null);\n    setHighLightedMessageId?.(null);\n    if (scrollRef?.current?.scrollTop > -1) {\n      scrollRef.current.scrollTop = (scrollRef?.current?.scrollHeight ?? 0) - (scrollRef?.current?.offsetHeight ?? 0);\n    }\n  };\n\n  /**\n   * 1. Move the messsage list scroll\n   *    when each message's height is changed by `reactions` OR `showEdit`\n   * 2. Keep the scrollBottom value after fetching new message list\n   */\n  const moveScroll = (isBottomMessageAffected = false): void => {\n    const current = scrollRef?.current;\n    if (current) {\n      const bottom = current.scrollHeight - current.scrollTop - current.offsetHeight;\n      if (scrollBottom < bottom\n        && (!isBottomMessageAffected || scrollBottom < SCROLL_BUFFER)) {\n        // Move the scroll as much as the height of the message has changed\n        current.scrollTop += bottom - scrollBottom;\n      }\n    }\n  };\n\n  const handleOnScroll = useHandleOnScrollCallback({\n    hasMore: hasMorePrev,\n    hasNext: hasMoreNext,\n    onScroll,\n    scrollRef,\n  });\n\n  const { scrollToBottomHandler, scrollBottom } = useSetScrollToBottom({ loading });\n\n  if (loading) {\n    return (typeof renderPlaceholderLoader === 'function')\n      ? renderPlaceholderLoader()\n      : <PlaceHolder type={PlaceHolderTypes.LOADING} />;\n  }\n  if (allMessagesFiltered.length < 1) {\n    if (renderPlaceholderEmpty && typeof renderPlaceholderEmpty === 'function') {\n      return renderPlaceholderEmpty();\n    }\n    return <PlaceHolder className=\"sendbird-conversation__no-messages\" type={PlaceHolderTypes.NO_MESSAGES} />;\n  }\n\n  return (\n    <>\n      {\n        !isScrolled && <PlaceHolder type={PlaceHolderTypes.LOADING} />\n      }\n      <div className={`sendbird-conversation__messages ${className}`}>\n        <div className=\"sendbird-conversation__scroll-container\">\n          <div className=\"sendbird-conversation__padding\" />\n          <div\n            className=\"sendbird-conversation__messages-padding\"\n            ref={scrollRef}\n            onScroll={(e) => {\n              handleOnScroll();\n              scrollToBottomHandler(e);\n            }}\n          >\n            {\n              allMessagesFiltered.map((m, idx) => {\n                const {\n                  chainTop,\n                  chainBottom,\n                  hasSeparator,\n                } = getMessagePartsInfo({\n                  allMessages: allMessagesFiltered,\n                  replyType,\n                  isMessageGroupingEnabled,\n                  currentIndex: idx,\n                  currentMessage: m,\n                  currentChannel: currentGroupChannel,\n                });\n                const isByMe = (m as UserMessage)?.sender?.userId === store?.config?.userId;\n                return (\n                  <MessageProvider message={m} key={m?.messageId} isByMe={isByMe}>\n                    <Message\n                      handleScroll={moveScroll}\n                      renderMessage={renderMessage}\n                      message={m as EveryMessage}\n                      hasSeparator={hasSeparator}\n                      chainTop={chainTop}\n                      chainBottom={chainBottom}\n                      renderCustomSeparator={renderCustomSeparator}\n                    />\n                  </MessageProvider>\n                );\n              })\n            }\n            {\n              localMessages.map((m, idx) => {\n                const {\n                  chainTop,\n                  chainBottom,\n                } = getMessagePartsInfo({\n                  allMessages: allMessagesFiltered,\n                  replyType,\n                  isMessageGroupingEnabled,\n                  currentIndex: idx,\n                  currentMessage: m,\n                  currentChannel: currentGroupChannel,\n                });\n                const isByMe = (m as UserMessage)?.sender?.userId === store?.config?.userId;\n                return (\n                  <MessageProvider message={m} key={m?.messageId} isByMe={isByMe}>\n                    <Message\n                      handleScroll={moveScroll}\n                      renderMessage={renderMessage}\n                      message={m as EveryMessage}\n                      chainTop={chainTop}\n                      chainBottom={chainBottom}\n                      renderCustomSeparator={renderCustomSeparator}\n                    />\n                  </MessageProvider>\n                );\n              })\n            }\n            {/* show frozen notifications, */}\n            {/* show new message notifications, */}\n          </div>\n        </div>\n        {currentGroupChannel?.isFrozen && (\n          <FrozenNotification className=\"sendbird-conversation__messages__notification\" />\n        )}\n        {unreadSince && (\n          <UnreadCount\n            className=\"sendbird-conversation__messages__notification\"\n            count={currentGroupChannel?.unreadMessageCount}\n            time={unreadSince}\n            onClick={() => {\n              if (scrollRef?.current?.scrollTop) {\n                scrollRef.current.scrollTop = (scrollRef?.current?.scrollHeight ?? 0) - (scrollRef?.current?.offsetHeight ?? 0);\n              }\n              if (!disableMarkAsRead && !!currentGroupChannel) {\n                markAsReadScheduler.push(currentGroupChannel);\n                messagesDispatcher({\n                  type: messageActionTypes.MARK_AS_READ,\n                  payload: { channel: currentGroupChannel },\n                });\n              }\n              setInitialTimeStamp(null);\n              setAnimatedMessageId(null);\n              setHighLightedMessageId(null);\n            }}\n          />\n        )}\n        {\n          // This flag is an unmatched variable\n          scrollBottom > SCROLL_BOTTOM_PADDING && (\n            <div\n              className=\"sendbird-conversation__scroll-bottom-button\"\n              onClick={onClickScrollBot}\n              onKeyDown={onClickScrollBot}\n              tabIndex={0}\n              role=\"button\"\n            >\n              <Icon\n                width=\"24px\"\n                height=\"24px\"\n                type={IconTypes.CHEVRON_DOWN}\n                fillColor={IconColors.PRIMARY}\n              />\n            </div>\n          )\n        }\n      </div>\n    </>\n  );\n};\n\nexport default MessageList;\n"],"names":["DELAY","useSetScrollToBottom","_a","loading","_b","useState","scrollBottom","setScrollBottom","useEffect","scrollCb","e","element","target","scrollHeight","scrollTop","offsetHeight","scrollToBottomHandler","useDebounce","useScrollBehavior","useChannelContext","scrollRef","scrollBehavior","current","style","SCROLL_BOTTOM_PADDING","MessageList","className","renderMessage","renderPlaceholderEmpty","renderCustomSeparator","renderPlaceholderLoader","_c","allMessages","localMessages","hasMorePrev","hasMoreNext","setInitialTimeStamp","setAnimatedMessageId","setHighLightedMessageId","isMessageGroupingEnabled","onScrollCallback","onScrollDownCallback","messagesDispatcher","messageActionTypes","currentGroupChannel","disableMarkAsRead","filterMessageList","replyType","isScrolled","unreadSince","store","useSendbirdStateContext","allMessagesFiltered","filter","markAsReadScheduler","config","onScroll","clientHeight","isAboutSame","SCROLL_BUFFER","messages","setTimeout","utils","error","type","MARK_AS_READ","payload","channel","push","onClickScrollBot","_e","_d","moveScroll","isBottomMessageAffected","bottom","handleOnScroll","useHandleOnScrollCallback","hasMore","hasNext","React","createElement","PlaceHolder","PlaceHolderTypes","LOADING","length","NO_MESSAGES","Fragment","concat","ref","map","m","idx","getMessagePartsInfo","currentIndex","currentMessage","currentChannel","chainTop","chainBottom","hasSeparator","isByMe","sender","userId","MessageProvider","message","key","messageId","Message","handleScroll","isFrozen","FrozenNotification","UnreadCount","count","unreadMessageCount","time","onClick","onKeyDown","tabIndex","role","Icon","width","height","IconTypes","CHEVRON_DOWN","fillColor","IconColors","PRIMARY"],"mappings":"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"}