{"version":3,"file":"useLongPress-18b7af79.js","sources":["../../src/hooks/useLongPress.tsx"],"sourcesContent":["// thanks to: https://stackoverflow.com/questions/48048957/react-long-press-event\n/* example:\n  const Component = ({ onClick }) => {\n    const onLongPress = useLongPress({\n      onClick: onClick,\n      onLongPress: () => {\n        alert('longpress');\n      }\n    }, {\n      delay: 500,\n      shouldPreventDefault: true,\n    });\n    return (\n      <button {...onLongPress}>\n        hello\n      </button>\n    )\n  }\n*/\nimport React, {\n  useState,\n  useRef,\n  useCallback,\n} from 'react';\nimport {\n  useMediaQueryContext,\n} from '../lib/MediaQueryContext';\n\nconst DEFAULT_DURATION = 300;\n\nfunction preventDefault(e: Event) {\n  if (!isTouchEvent(e)) {\n    return;\n  }\n\n  if (e.touches.length < 2 && e.preventDefault) {\n    e.preventDefault();\n  }\n}\n\nexport function isTouchEvent(e: Event): e is TouchEvent {\n  return e && 'touches' in e;\n}\n\ninterface PressHandlers<T> {\n  onLongPress: (e: React.MouseEvent<T> | React.TouchEvent<T>) => void;\n  onClick?: (e: React.MouseEvent<T> | React.TouchEvent<T>) => void;\n}\n\ninterface Options {\n  delay?: number;\n  shouldPreventDefault?: boolean;\n  shouldStopPropagation?: boolean;\n}\n\ninterface UseLongPressType<T> {\n  onTouchMove: (e: React.TouchEvent<T>) => void;\n  onMouseDown: (e: React.MouseEvent<T>) => void;\n  onTouchStart: (e: React.TouchEvent<T>) => void;\n  onMouseUp: (e: React.MouseEvent<T>) => void;\n  onMouseLeave: (e: React.MouseEvent<T>) => void;\n  onTouchEnd: (e: React.TouchEvent<T>) => void;\n}\n\nexport default function useLongPress<T>({\n  onLongPress,\n  onClick,\n}: PressHandlers<T>, {\n  delay = DEFAULT_DURATION,\n  shouldPreventDefault = true,\n  shouldStopPropagation = false,\n}: Options = {}): UseLongPressType<T> {\n  const { isMobile } = useMediaQueryContext();\n  const [longPressTriggered, setLongPressTriggered] = useState(false);\n  const [dragTriggered, setDragTriggered] = useState(false);\n  // https://www.typescriptlang.org/docs/handbook/utility-types.html#returntypetype\n  const timeout = useRef<ReturnType<typeof setTimeout>>();\n  const target = useRef<EventTarget>();\n\n  const start = useCallback((e: React.MouseEvent<T> | React.TouchEvent<T>) => {\n    e.persist();\n    const clonedEvent = {\n      ...e,\n    };\n    setDragTriggered(false);\n    if (shouldStopPropagation) {\n      e.stopPropagation();\n    }\n    if (shouldPreventDefault && e.target) {\n      e.target.addEventListener(\n        'touchend',\n        preventDefault,\n        {\n          passive: false,\n        },\n      );\n      target.current = e.target;\n    }\n\n    timeout.current = setTimeout(() => {\n      onLongPress(clonedEvent);\n      setLongPressTriggered(true);\n    }, delay);\n  }, [onLongPress, delay, shouldPreventDefault, shouldStopPropagation, isMobile]);\n\n  const clear = useCallback((\n    e: React.MouseEvent<T> | React.TouchEvent<T>,\n    shouldTriggerClick = true,\n    onDrag = false,\n  ) => {\n    if (onDrag) {\n      setDragTriggered(true);\n    } else {\n      setDragTriggered(false);\n    }\n    if (timeout?.current) {\n      clearTimeout(timeout.current);\n    }\n    if (shouldTriggerClick && !longPressTriggered && !dragTriggered) {\n      onClick?.(e);\n    }\n    setLongPressTriggered(false);\n    if (shouldPreventDefault && target.current) {\n      target.current.removeEventListener('touchend', preventDefault);\n    }\n  }, [shouldPreventDefault, onClick, longPressTriggered, dragTriggered]);\n\n  return {\n    onMouseDown: (e: React.MouseEvent<T>) => start(e),\n    onMouseUp: (e: React.MouseEvent<T>) => clear(e),\n    onMouseLeave: (e: React.MouseEvent<T>) => clear(e, false),\n    onTouchStart: (e: React.TouchEvent<T>) => start(e),\n    // setDragTriggered as true on touchmove, so that next onTouchEnd is ignored\n    // if we dont do it, onClick?.(e) will be triggred, see inside clear()\n    onTouchMove: (e: React.TouchEvent<T>) => clear(e, false, true),\n    onTouchEnd: (e: React.TouchEvent<T>) => clear(e),\n  };\n}\n"],"names":["DEFAULT_DURATION","preventDefault","e","isTouchEvent","touches","length","useLongPress","_a","_b","onLongPress","onClick","_c","_d","delay","_e","shouldPreventDefault","_f","shouldStopPropagation","isMobile","useMediaQueryContext","_g","useState","longPressTriggered","setLongPressTriggered","_h","dragTriggered","setDragTriggered","timeout","useRef","target","start","useCallback","persist","clonedEvent","__assign","stopPropagation","addEventListener","passive","current","setTimeout","clear","shouldTriggerClick","onDrag","clearTimeout","removeEventListener","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchMove","onTouchEnd"],"mappings":";;;;;;AA4BA,IAAMA,gBAAgB,GAAG,GAAG,CAAA;AAE5B,SAASC,cAAcA,CAACC,CAAQ,EAAA;AAC9B,EAAA,IAAI,CAACC,YAAY,CAACD,CAAC,CAAC,EAAE;AACpB,IAAA,OAAA;AACD,GAAA;EAED,IAAIA,CAAC,CAACE,OAAO,CAACC,MAAM,GAAG,CAAC,IAAIH,CAAC,CAACD,cAAc,EAAE;IAC5CC,CAAC,CAACD,cAAc,EAAE,CAAA;AACnB,GAAA;AACH,CAAA;AAEM,SAAUE,YAAYA,CAACD,CAAQ,EAAA;AACnC,EAAA,OAAOA,CAAC,IAAI,SAAS,IAAIA,CAAC,CAAA;AAC5B,CAAA;AAsBc,SAAUI,YAAYA,CAAIC,EAGrB,EAAEC,EAIN,EAAA;MANbC,WAAW,GAAAF,EAAA,CAAAE,WAAA;IACXC,OAAO,GAAAH,EAAA,CAAAG,OAAA,CAAA;MACYC,EAIR,GAAAH,EAAA,KAAA,KAAA,CAAA,GAAA,EAAE,KAAA;IAHbI,EAAA,GAAAD,EAAA,CAAAE,KAAwB;IAAxBA,KAAK,GAAAD,EAAA,KAAA,KAAA,CAAA,GAAGZ,gBAAgB,GAAAY,EAAA;IACxBE,EAAA,GAAAH,EAAA,CAAAI,oBAA2B;IAA3BA,oBAAoB,GAAAD,EAAA,KAAA,KAAA,CAAA,GAAG,IAAI,GAAAA,EAAA;IAC3BE,6BAA6B;IAA7BC,qBAAqB,GAAGD,EAAA,KAAA,KAAA,CAAA,GAAA,KAAK,GAAAA,EAAA,CAAA;AAErB,EAAA,IAAAE,QAAQ,GAAKC,sCAAoB,EAAE,SAA3B,CAAA;AACV,EAAA,IAAAC,EAAA,GAA8CC,cAAQ,CAAC,KAAK,CAAC;AAA5DC,IAAAA,kBAAkB,GAAAF,EAAA,CAAA,CAAA,CAAA;AAAEG,IAAAA,qBAAqB,GAAAH,EAAA,CAAA,CAAA,CAAmB,CAAA;AAC7D,EAAA,IAAAI,EAAA,GAAoCH,cAAQ,CAAC,KAAK,CAAC;AAAlDI,IAAAA,aAAa,GAAAD,EAAA,CAAA,CAAA,CAAA;AAAEE,IAAAA,gBAAgB,GAAAF,EAAA,CAAA,CAAA,CAAmB,CAAA;AACzD;AACA,EAAA,IAAMG,OAAO,GAAGC,YAAM,EAAiC,CAAA;AACvD,EAAA,IAAMC,MAAM,GAAGD,YAAM,EAAe,CAAA;AAEpC,EAAA,IAAME,KAAK,GAAGC,iBAAW,CAAC,UAAC7B,CAA4C,EAAA;IACrEA,CAAC,CAAC8B,OAAO,EAAE,CAAA;IACX,IAAMC,WAAW,GAAAC,kBAAA,CAAA,EAAA,EACZhC,CAAC,CACL,CAAA;IACDwB,gBAAgB,CAAC,KAAK,CAAC,CAAA;AACvB,IAAA,IAAIT,qBAAqB,EAAE;MACzBf,CAAC,CAACiC,eAAe,EAAE,CAAA;AACpB,KAAA;AACD,IAAA,IAAIpB,oBAAoB,IAAIb,CAAC,CAAC2B,MAAM,EAAE;MACpC3B,CAAC,CAAC2B,MAAM,CAACO,gBAAgB,CACvB,UAAU,EACVnC,cAAc,EACd;AACEoC,QAAAA,OAAO,EAAE,KAAA;AACV,OAAA,CACF,CAAA;AACDR,MAAAA,MAAM,CAACS,OAAO,GAAGpC,CAAC,CAAC2B,MAAM,CAAA;AAC1B,KAAA;AAEDF,IAAAA,OAAO,CAACW,OAAO,GAAGC,UAAU,CAAC,YAAA;MAC3B9B,WAAW,CAACwB,WAAW,CAAC,CAAA;MACxBV,qBAAqB,CAAC,IAAI,CAAC,CAAA;KAC5B,EAAEV,KAAK,CAAC,CAAA;AACX,GAAC,EAAE,CAACJ,WAAW,EAAEI,KAAK,EAAEE,oBAAoB,EAAEE,qBAAqB,EAAEC,QAAQ,CAAC,CAAC,CAAA;EAE/E,IAAMsB,KAAK,GAAGT,iBAAW,CAAC,UACxB7B,CAA4C,EAC5CuC,kBAAyB,EACzBC,MAAc,EAAA;AADd,IAAA,IAAAD,kBAAA,KAAA,KAAA,CAAA,EAAA;AAAAA,MAAAA,kBAAyB,GAAA,IAAA,CAAA;AAAA,KAAA;AACzB,IAAA,IAAAC,MAAA,KAAA,KAAA,CAAA,EAAA;AAAAA,MAAAA,MAAc,GAAA,KAAA,CAAA;AAAA,KAAA;AAEd,IAAA,IAAIA,MAAM,EAAE;MACVhB,gBAAgB,CAAC,IAAI,CAAC,CAAA;AACvB,KAAA,MAAM;MACLA,gBAAgB,CAAC,KAAK,CAAC,CAAA;AACxB,KAAA;AACD,IAAA,IAAIC,OAAO,KAAP,IAAA,IAAAA,OAAO,uBAAPA,OAAO,CAAEW,OAAO,EAAE;AACpBK,MAAAA,YAAY,CAAChB,OAAO,CAACW,OAAO,CAAC,CAAA;AAC9B,KAAA;AACD,IAAA,IAAIG,kBAAkB,IAAI,CAACnB,kBAAkB,IAAI,CAACG,aAAa,EAAE;AAC/Df,MAAAA,OAAO,aAAPA,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAPA,OAAO,CAAGR,CAAC,CAAC,CAAA;AACb,KAAA;IACDqB,qBAAqB,CAAC,KAAK,CAAC,CAAA;AAC5B,IAAA,IAAIR,oBAAoB,IAAIc,MAAM,CAACS,OAAO,EAAE;MAC1CT,MAAM,CAACS,OAAO,CAACM,mBAAmB,CAAC,UAAU,EAAE3C,cAAc,CAAC,CAAA;AAC/D,KAAA;GACF,EAAE,CAACc,oBAAoB,EAAEL,OAAO,EAAEY,kBAAkB,EAAEG,aAAa,CAAC,CAAC,CAAA;EAEtE,OAAO;AACLoB,IAAAA,WAAW,EAAE,UAAC3C,CAAsB,EAAK;MAAA,OAAA4B,KAAK,CAAC5B,CAAC,CAAC,CAAA;KAAA;AACjD4C,IAAAA,SAAS,EAAE,UAAC5C,CAAsB,EAAK;MAAA,OAAAsC,KAAK,CAACtC,CAAC,CAAC,CAAA;KAAA;AAC/C6C,IAAAA,YAAY,EAAE,UAAC7C,CAAsB,EAAA;AAAK,MAAA,OAAAsC,KAAK,CAACtC,CAAC,EAAE,KAAK,CAAC,CAAA;KAAA;AACzD8C,IAAAA,YAAY,EAAE,UAAC9C,CAAsB,EAAK;MAAA,OAAA4B,KAAK,CAAC5B,CAAC,CAAC,CAAA;KAAA;AAClD;AACA;AACA+C,IAAAA,WAAW,EAAE,UAAC/C,CAAsB,EAAA;AAAK,MAAA,OAAAsC,KAAK,CAACtC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,CAAA;KAAA;AAC9DgD,IAAAA,UAAU,EAAE,UAAChD,CAAsB,EAAK;MAAA,OAAAsC,KAAK,CAACtC,CAAC,CAAC,CAAA;AAAR,KAAA;GACzC,CAAA;AACH;;;;"}