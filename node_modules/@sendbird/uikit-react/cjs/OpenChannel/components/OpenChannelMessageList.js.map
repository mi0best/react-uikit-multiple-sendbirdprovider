{"version":3,"file":"OpenChannelMessageList.js","sources":["../../../../src/modules/OpenChannel/components/OpenChannelMessageList/index.tsx"],"sourcesContent":["import './openchannel-message-list.scss';\n\nimport React, { ReactElement, useRef, useState, useMemo } from 'react';\nimport { UserMessage } from '@sendbird/chat/message';\nimport isSameDay from 'date-fns/isSameDay';\n\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\n\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport { compareMessagesForGrouping } from '../../context/utils';\nimport { useOpenChannelContext } from '../../context/OpenChannelProvider';\nimport OpenChannelMessage from '../OpenChannelMessage';\nimport { RenderMessageProps } from '../../../../types';\nimport { MessageProvider } from '../../../Message/context/MessageProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { useHandleOnScrollCallback } from '../../../../hooks/useHandleOnScrollCallback';\n\nexport type OpenchannelMessageListProps = {\n  renderMessage?: (props: RenderMessageProps) => React.ElementType<RenderMessageProps>;\n  renderPlaceHolderEmptyList?: () => React.ReactElement;\n};\n\nfunction OpenchannelMessageList(\n  props: OpenchannelMessageListProps,\n  ref: React.RefObject<HTMLDivElement>,\n): ReactElement {\n  const {\n    isMessageGroupingEnabled = true,\n    allMessages,\n    hasMore,\n    onScroll,\n  } = useOpenChannelContext();\n  const store = useSendbirdStateContext();\n  const userId = store.config.userId;\n  const scrollRef = ref || useRef(null);\n  const [showScrollDownButton, setShowScrollDownButton] = useState(false);\n\n  const scrollToBottom = () => {\n    if (scrollRef && scrollRef.current) {\n      scrollRef.current.scrollTo(0, scrollRef.current.scrollHeight);\n      setShowScrollDownButton(false);\n    }\n  };\n\n  const handleOnScroll = useHandleOnScrollCallback({\n    setShowScrollDownButton,\n    hasMore,\n    onScroll,\n    scrollRef,\n  });\n\n  const memoizedMessageList = useMemo(() => {\n    if (allMessages.length > 0) {\n      return (\n        allMessages.map((message, index) => {\n          const previousMessage = allMessages[index - 1];\n          const nextMessage = allMessages[index - 1];\n\n          const previousMessageCreatedAt = previousMessage && previousMessage.createdAt;\n          const currentCreatedAt = message?.createdAt;\n          // https://stackoverflow.com/a/41855608\n          const hasSeparator = !(previousMessageCreatedAt && (\n            isSameDay(currentCreatedAt, previousMessageCreatedAt)\n          ));\n\n          const [chainTop, chainBottom] = isMessageGroupingEnabled\n            ? compareMessagesForGrouping(previousMessage, message, nextMessage)\n            : [false, false];\n          const isByMe = (message as UserMessage)?.sender?.userId === userId;\n          const key = message?.messageId || (message as UserMessage)?.reqId;\n          return (\n            <MessageProvider message={message} isByMe={isByMe} key={key}>\n              <OpenChannelMessage\n                message={message}\n                chainTop={chainTop}\n                chainBottom={chainBottom}\n                hasSeparator={hasSeparator}\n                renderMessage={props?.renderMessage}\n              />\n            </MessageProvider>\n          );\n        })\n      );\n    }\n    return (\n      props?.renderPlaceHolderEmptyList?.() || (\n        <PlaceHolder\n          className=\"sendbird-openchannel-conversation-scroll__container__place-holder\"\n          type={PlaceHolderTypes.NO_MESSAGES}\n        />\n      )\n    );\n  }, [allMessages]);\n\n  return (\n    <div className=\"sendbird-openchannel-conversation-scroll\">\n      <div className=\"sendbird-openchannel-conversation-scroll__container\">\n        <div className=\"sendbird-openchannel-conversation-scroll__container__padding\" />\n        <div\n          className={[\n            'sendbird-openchannel-conversation-scroll__container__item-container',\n            (allMessages.length > 0) ? '' : 'no-messages',\n          ].join(' ')}\n          onScroll={handleOnScroll}\n          ref={scrollRef}\n        >\n          {memoizedMessageList}\n        </div>\n      </div>\n      {\n        showScrollDownButton && (\n          <div\n            className=\"sendbird-openchannel-conversation-scroll__container__scroll-bottom-button\"\n            onClick={scrollToBottom}\n            onKeyDown={scrollToBottom}\n            tabIndex={0}\n            role=\"button\"\n          >\n            <Icon\n              width=\"24px\"\n              height=\"24px\"\n              type={IconTypes.CHEVRON_DOWN}\n              fillColor={IconColors.CONTENT}\n            />\n          </div>\n        )\n      }\n    </div>\n  );\n}\n\nexport default React.forwardRef(OpenchannelMessageList);\n"],"names":["OpenchannelMessageList","props","ref","_a","useOpenChannelContext","_b","isMessageGroupingEnabled","allMessages","hasMore","onScroll","store","useSendbirdStateContext","userId","config","scrollRef","useRef","_c","useState","showScrollDownButton","setShowScrollDownButton","scrollToBottom","current","scrollTo","scrollHeight","handleOnScroll","useHandleOnScrollCallback","memoizedMessageList","useMemo","length","map","message","index","previousMessage","nextMessage","previousMessageCreatedAt","createdAt","currentCreatedAt","hasSeparator","isSameDay","compareMessagesForGrouping","chainTop","chainBottom","isByMe","sender","key","messageId","reqId","React","createElement","MessageProvider","OpenChannelMessage","renderMessage","renderPlaceHolderEmptyList","call","PlaceHolder","className","type","PlaceHolderTypes","NO_MESSAGES","join","onClick","onKeyDown","tabIndex","role","Icon","width","height","IconTypes","CHEVRON_DOWN","fillColor","IconColors","CONTENT","forwardRef"],"mappings":"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"}