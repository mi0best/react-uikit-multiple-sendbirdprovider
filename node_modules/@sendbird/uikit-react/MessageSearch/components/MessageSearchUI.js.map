{"version":3,"file":"MessageSearchUI.js","sources":["../../../src/modules/MessageSearch/components/MessageSearchUI/index.tsx"],"sourcesContent":["import React, { useContext } from 'react';\nimport type { FileMessage, UserMessage } from '@sendbird/chat/message';\nimport './index.scss';\n\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useMessageSearchContext } from '../../context/MessageSearchProvider';\n\nimport MessageSearchItem from '../../../../ui/MessageSearchItem';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport MessageSearchFileItem from '../../../../ui/MessageSearchFileItem';\nimport { ClientSentMessages } from '../../../../types';\n\nconst COMPONENT_CLASS_NAME = 'sendbird-message-search';\n\nexport interface MessageSearchUIProps {\n  renderPlaceHolderError?: (props: void) => React.ReactElement;\n  renderPlaceHolderLoading?: (props: void) => React.ReactElement;\n  renderPlaceHolderNoString?: (props: void) => React.ReactElement;\n  renderPlaceHolderEmptyList?: (props: void) => React.ReactElement;\n  renderSearchItem?(\n    {\n      message,\n      onResultClick,\n    }: {\n      message: ClientSentMessages,\n      onResultClick?: (message: ClientSentMessages) => void,\n    }\n  ): JSX.Element;\n}\n\nexport const MessageSearchUI: React.FC<MessageSearchUIProps> = ({\n  renderPlaceHolderError,\n  renderPlaceHolderLoading,\n  renderPlaceHolderNoString,\n  renderPlaceHolderEmptyList,\n  renderSearchItem,\n}: MessageSearchUIProps) => {\n  const {\n    isInvalid,\n    searchString,\n    requestString,\n    currentChannel,\n    retryCount,\n    setRetryCount,\n    loading,\n    scrollRef,\n    hasMoreResult,\n    onScroll,\n    allMessages,\n    onResultClick,\n    selectedMessageId,\n    setSelectedMessageId,\n  } = useMessageSearchContext();\n\n  const { stringSet } = useContext(LocalizationContext);\n\n  const handleRetryToConnect = () => {\n    setRetryCount(retryCount + 1);\n  };\n\n  const handleOnScroll = (e) => {\n    const scrollElement = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = scrollElement;\n\n    if (!hasMoreResult) {\n      return;\n    }\n    if (scrollTop + clientHeight >= scrollHeight - 1) {\n      onScroll(() => {\n        // after load more searched messages\n      });\n    }\n  };\n\n  const getChannelName = () => {\n    if (currentChannel && currentChannel?.name && currentChannel?.name !== 'Group Channel') {\n      return currentChannel?.name;\n    }\n    if (currentChannel && (currentChannel?.name === 'Group Channel' || !currentChannel?.name)) {\n      return currentChannel.members.map((member) => member.nickname || stringSet.NO_NAME).join(', ');\n    }\n    return stringSet.NO_TITLE;\n  };\n\n  if (isInvalid && searchString && requestString) {\n    return renderPlaceHolderError?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.WRONG}\n          retryToConnect={handleRetryToConnect}\n        />\n      </div>\n    );\n  }\n\n  if (loading && searchString && requestString) {\n    return renderPlaceHolderLoading?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder type={PlaceHolderTypes.SEARCHING} />\n      </div>\n    );\n  }\n\n  if (!searchString) {\n    return renderPlaceHolderNoString?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.SEARCH_IN}\n          searchInString={getChannelName()}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={COMPONENT_CLASS_NAME}\n      onScroll={handleOnScroll}\n      ref={scrollRef}\n    >\n      {\n        (allMessages.length > 0)\n          ? (\n            allMessages.map((message) => {\n              if (renderSearchItem) {\n                return renderSearchItem({ message, onResultClick });\n              }\n              if (message.messageType === 'file') {\n                return (\n                  <MessageSearchFileItem\n                    className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                    message={message as FileMessage}\n                    key={message.messageId}\n                    selected={(selectedMessageId === message.messageId)}\n                    onClick={() => {\n                      onResultClick(message);\n                      setSelectedMessageId(message.messageId);\n                    }}\n                  />\n                );\n              }\n              return (\n                <MessageSearchItem\n                  className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                  message={message as UserMessage}\n                  key={message.messageId}\n                  selected={(selectedMessageId === message.messageId)}\n                  onClick={() => {\n                    onResultClick(message);\n                    setSelectedMessageId(message.messageId);\n                  }}\n                />\n              );\n            })\n          )\n          : renderPlaceHolderEmptyList?.() || (\n            <PlaceHolder type={PlaceHolderTypes.NO_RESULTS} />\n          )\n      }\n    </div>\n  );\n};\n\nexport default MessageSearchUI;\n"],"names":["COMPONENT_CLASS_NAME","MessageSearchUI","_a","renderPlaceHolderError","renderPlaceHolderLoading","renderPlaceHolderNoString","renderPlaceHolderEmptyList","renderSearchItem","_b","useMessageSearchContext","isInvalid","searchString","requestString","currentChannel","retryCount","setRetryCount","loading","scrollRef","hasMoreResult","onScroll","allMessages","onResultClick","selectedMessageId","setSelectedMessageId","stringSet","useContext","LocalizationContext","handleRetryToConnect","handleOnScroll","e","scrollElement","target","scrollTop","scrollHeight","clientHeight","getChannelName","name","members","map","member","nickname","NO_NAME","join","NO_TITLE","React","createElement","className","PlaceHolder","type","PlaceHolderTypes","WRONG","retryToConnect","SEARCHING","SEARCH_IN","searchInString","ref","length","message","messageType","MessageSearchFileItem","concat","key","messageId","selected","onClick","MessageSearchItem","NO_RESULTS"],"mappings":"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"}