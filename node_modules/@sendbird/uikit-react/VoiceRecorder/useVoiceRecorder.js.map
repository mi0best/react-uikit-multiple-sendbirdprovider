{"version":3,"file":"useVoiceRecorder.js","sources":["../../src/hooks/VoiceRecorder/useVoiceRecorder.tsx"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport { VoiceRecorderEventHandler, useVoiceRecorderContext } from '.';\nimport useSendbirdStateContext from '../useSendbirdStateContext';\n\n// export interface UseVoiceRecorderProps extends VoiceRecorderEventHandler {\n//   /**\n//    * onRecordingStarted\n//    * onRecordingEnded\n//    */\n// }\n/* eslint-disable no-redeclare */\nexport const VoiceRecorderStatus = {\n  PREPARING: 'PREPARING',\n  READY_TO_RECORD: 'READY_TO_RECORD',\n  RECORDING: 'RECORDING',\n  COMPLETED: 'COMPLETED',\n} as const;\nexport type VoiceRecorderStatus = typeof VoiceRecorderStatus[keyof typeof VoiceRecorderStatus];\nexport interface UseVoiceRecorderContext {\n  start: () => void;\n  stop: () => void;\n  cancel: () => void;\n  recordingLimit: number;\n  recordingTime: number;\n  recordedFile: File;\n  recordingStatus: VoiceRecorderStatus;\n}\n\nconst noop = () => { /* noop */ };\n\nexport const useVoiceRecorder = ({\n  onRecordingStarted = noop,\n  onRecordingEnded = noop,\n}: VoiceRecorderEventHandler): UseVoiceRecorderContext => {\n  const { config } = useSendbirdStateContext();\n  const { voiceRecord } = config;\n  const { maxRecordingTime } = voiceRecord;\n  const voiceRecorder = useVoiceRecorderContext();\n  const { isRecordable } = voiceRecorder;\n\n  const [recordedFile, setRecordedFile] = useState<File>(null);\n  const [recordingStatus, setRecordingStatus] = useState<VoiceRecorderStatus>(VoiceRecorderStatus.PREPARING);\n  useEffect(() => {\n    if (isRecordable && recordingStatus === VoiceRecorderStatus.PREPARING) {\n      setRecordingStatus(VoiceRecorderStatus.READY_TO_RECORD);\n    }\n  }, [isRecordable]);\n\n  const start = useCallback(() => {\n    voiceRecorder?.start({\n      onRecordingStarted: () => {\n        setRecordingStatus(VoiceRecorderStatus.RECORDING);\n        onRecordingStarted();\n        startTimer();\n      },\n      onRecordingEnded: (audioFile) => {\n        setRecordingStatus(VoiceRecorderStatus.COMPLETED);\n        onRecordingEnded(audioFile);\n        setRecordedFile(audioFile);\n        stopTimer();\n      },\n    });\n  }, [onRecordingStarted, onRecordingEnded]);\n  const stop = useCallback(() => {\n    voiceRecorder?.stop();\n    stopTimer();\n  }, [voiceRecorder]);\n  const cancel = useCallback(() => {\n    stop();\n    setRecordedFile(null);\n  }, [voiceRecorder]);\n\n  // Timer\n  const [recordingTime, setRecordingTime] = useState<number>(0);\n  let timer: ReturnType<typeof setInterval> = null;\n  function startTimer() {\n    stopTimer();\n    setRecordingTime(0);\n    const interval = setInterval(() => {\n      setRecordingTime(prevTime => {\n        const newTime = prevTime + 100;\n        if (newTime > maxRecordingTime) {\n          stopTimer();\n        }\n        return newTime;\n      });\n    }, 100);\n    timer = interval;\n  }\n  function stopTimer() {\n    clearInterval(timer);\n    timer = null;\n  }\n  useEffect(() => {\n    if (recordingTime > maxRecordingTime) {\n      stop();\n    }\n  }, [recordingTime, maxRecordingTime, stop]);\n\n  return ({\n    start,\n    stop,\n    cancel,\n    recordingStatus,\n    recordingTime,\n    recordedFile,\n    recordingLimit: maxRecordingTime,\n  });\n};\n"],"names":["VoiceRecorderStatus","PREPARING","READY_TO_RECORD","RECORDING","COMPLETED","noop","useVoiceRecorder","_a","_b","onRecordingStarted","_c","onRecordingEnded","config","useSendbirdStateContext","voiceRecord","maxRecordingTime","voiceRecorder","useVoiceRecorderContext","isRecordable","_d","useState","recordedFile","setRecordedFile","_e","recordingStatus","setRecordingStatus","useEffect","start","useCallback","startTimer","audioFile","stopTimer","stop","cancel","_f","recordingTime","setRecordingTime","timer","interval","setInterval","prevTime","newTime","clearInterval","recordingLimit"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,IAAMA,mBAAmB,GAAG;AACjCC,EAAAA,SAAS,EAAE,WAAW;AACtBC,EAAAA,eAAe,EAAE,iBAAiB;AAClCC,EAAAA,SAAS,EAAE,WAAW;AACtBC,EAAAA,SAAS,EAAE,WAAA;EACH;AAYV,IAAMC,IAAI,GAAG,YAAmB,EAAC,CAAA;IAEpBC,gBAAgB,GAAG,UAACC,EAGL,EAAA;MAF1BC,EAAyB,GAAAD,EAAA,CAAAE,kBAAA;IAAzBA,kBAAkB,GAAAD,EAAA,KAAA,KAAA,CAAA,GAAGH,IAAI,GAAAG,EAAA;IACzBE,EAAA,GAAAH,EAAA,CAAAI,gBAAuB;IAAvBA,gBAAgB,GAAGD,EAAA,KAAA,KAAA,CAAA,GAAAL,IAAI,GAAAK,EAAA,CAAA;AAEf,EAAA,IAAAE,MAAM,GAAKC,uBAAuB,EAAE,OAA9B,CAAA;AACN,EAAA,IAAAC,WAAW,GAAKF,MAAM,CAAAE,WAAX,CAAA;AACX,EAAA,IAAAC,gBAAgB,GAAKD,WAAW,CAAAC,gBAAhB,CAAA;AACxB,EAAA,IAAMC,aAAa,GAAGC,uBAAuB,EAAE,CAAA;AACvC,EAAA,IAAAC,YAAY,GAAKF,aAAa,CAAAE,YAAlB,CAAA;AAEd,EAAA,IAAAC,EAAA,GAAkCC,QAAQ,CAAO,IAAI,CAAC;AAArDC,IAAAA,YAAY,GAAAF,EAAA,CAAA,CAAA,CAAA;AAAEG,IAAAA,eAAe,GAAAH,EAAA,CAAA,CAAA,CAAwB,CAAA;AACtD,EAAA,IAAAI,EAAwC,GAAAH,QAAQ,CAAsBpB,mBAAmB,CAACC,SAAS,CAAC;AAAnGuB,IAAAA,eAAe,GAAAD,EAAA,CAAA,CAAA,CAAA;AAAEE,IAAAA,kBAAkB,QAAgE,CAAA;AAC1GC,EAAAA,SAAS,CAAC,YAAA;AACR,IAAA,IAAIR,YAAY,IAAIM,eAAe,KAAKxB,mBAAmB,CAACC,SAAS,EAAE;AACrEwB,MAAAA,kBAAkB,CAACzB,mBAAmB,CAACE,eAAe,CAAC,CAAA;AACxD,KAAA;AACH,GAAC,EAAE,CAACgB,YAAY,CAAC,CAAC,CAAA;AAElB,EAAA,IAAMS,KAAK,GAAGC,WAAW,CAAC,YAAA;AACxBZ,IAAAA,aAAa,aAAbA,aAAa,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAbA,aAAa,CAAEW,KAAK,CAAC;MACnBlB,kBAAkB,EAAE,YAAA;AAClBgB,QAAAA,kBAAkB,CAACzB,mBAAmB,CAACG,SAAS,CAAC,CAAA;AACjDM,QAAAA,kBAAkB,EAAE,CAAA;AACpBoB,QAAAA,UAAU,EAAE,CAAA;OACb;AACDlB,MAAAA,gBAAgB,EAAE,UAACmB,SAAS,EAAA;AAC1BL,QAAAA,kBAAkB,CAACzB,mBAAmB,CAACI,SAAS,CAAC,CAAA;QACjDO,gBAAgB,CAACmB,SAAS,CAAC,CAAA;QAC3BR,eAAe,CAACQ,SAAS,CAAC,CAAA;AAC1BC,QAAAA,SAAS,EAAE,CAAA;AACb,OAAA;AACD,KAAA,CAAC,CAAA;AACJ,GAAC,EAAE,CAACtB,kBAAkB,EAAEE,gBAAgB,CAAC,CAAC,CAAA;AAC1C,EAAA,IAAMqB,IAAI,GAAGJ,WAAW,CAAC,YAAA;AACvBZ,IAAAA,aAAa,aAAbA,aAAa,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAbA,aAAa,CAAEgB,IAAI,EAAE,CAAA;AACrBD,IAAAA,SAAS,EAAE,CAAA;AACb,GAAC,EAAE,CAACf,aAAa,CAAC,CAAC,CAAA;AACnB,EAAA,IAAMiB,MAAM,GAAGL,WAAW,CAAC,YAAA;AACzBI,IAAAA,IAAI,EAAE,CAAA;IACNV,eAAe,CAAC,IAAI,CAAC,CAAA;AACvB,GAAC,EAAE,CAACN,aAAa,CAAC,CAAC,CAAA;AAEnB;AACM,EAAA,IAAAkB,EAAA,GAAoCd,QAAQ,CAAS,CAAC,CAAC;AAAtDe,IAAAA,aAAa,GAAAD,EAAA,CAAA,CAAA,CAAA;AAAEE,IAAAA,gBAAgB,GAAAF,EAAA,CAAA,CAAA,CAAuB,CAAA;EAC7D,IAAIG,KAAK,GAAmC,IAAI,CAAA;EAChD,SAASR,UAAUA,GAAA;AACjBE,IAAAA,SAAS,EAAE,CAAA;IACXK,gBAAgB,CAAC,CAAC,CAAC,CAAA;AACnB,IAAA,IAAME,QAAQ,GAAGC,WAAW,CAAC,YAAA;MAC3BH,gBAAgB,CAAC,UAAAI,QAAQ,EAAA;AACvB,QAAA,IAAMC,OAAO,GAAGD,QAAQ,GAAG,GAAG,CAAA;QAC9B,IAAIC,OAAO,GAAG1B,gBAAgB,EAAE;AAC9BgB,UAAAA,SAAS,EAAE,CAAA;AACZ,SAAA;AACD,QAAA,OAAOU,OAAO,CAAA;AAChB,OAAC,CAAC,CAAA;KACH,EAAE,GAAG,CAAC,CAAA;AACPJ,IAAAA,KAAK,GAAGC,QAAQ,CAAA;AAClB,GAAA;EACA,SAASP,SAASA,GAAA;IAChBW,aAAa,CAACL,KAAK,CAAC,CAAA;AACpBA,IAAAA,KAAK,GAAG,IAAI,CAAA;AACd,GAAA;AACAX,EAAAA,SAAS,CAAC,YAAA;IACR,IAAIS,aAAa,GAAGpB,gBAAgB,EAAE;AACpCiB,MAAAA,IAAI,EAAE,CAAA;AACP,KAAA;GACF,EAAE,CAACG,aAAa,EAAEpB,gBAAgB,EAAEiB,IAAI,CAAC,CAAC,CAAA;EAE3C,OAAQ;AACNL,IAAAA,KAAK,EAAAA,KAAA;AACLK,IAAAA,IAAI,EAAAA,IAAA;AACJC,IAAAA,MAAM,EAAAA,MAAA;AACNT,IAAAA,eAAe,EAAAA,eAAA;AACfW,IAAAA,aAAa,EAAAA,aAAA;AACbd,IAAAA,YAAY,EAAAA,YAAA;AACZsB,IAAAA,cAAc,EAAE5B,gBAAAA;GACjB,CAAA;AACH;;;;"}